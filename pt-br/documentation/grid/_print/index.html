<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=pt-br class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://www.selenium.dev/pt-br/documentation/grid/><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Grid | Selenium</title>
<meta name=description content="Pretende executar testes em paralelo em várias máquinas? Então a Grid é para si.
"><meta property="og:url" content="https://www.selenium.dev/pt-br/documentation/grid/"><meta property="og:site_name" content="Selenium"><meta property="og:title" content="Grid"><meta property="og:description" content="Pretende executar testes em paralelo em várias máquinas? Então a Grid é para si."><meta property="og:locale" content="pt-br"><meta property="og:type" content="website"><meta property="og:image" content="https://www.selenium.dev/images/selenium_4_logo.png"><meta itemprop=name content="Grid"><meta itemprop=description content="Pretende executar testes em paralelo em várias máquinas? Então a Grid é para si.
"><meta itemprop=dateModified content="2024-02-06T13:37:55+00:00"><meta itemprop=wordCount content="72"><meta itemprop=image content="https://www.selenium.dev/images/selenium_4_logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.selenium.dev/images/selenium_4_logo.png"><meta name=twitter:title content="Grid"><meta name=twitter:description content="Pretende executar testes em paralelo em várias máquinas? Então a Grid é para si.
"><link rel=preload href=/scss/main.min.fd681802c710400e4a80e7b05f52131ed32ee635cc502b20a496c56fb93c750f.css as=style><link href=/scss/main.min.fd681802c710400e4a80e7b05f52131ed32ee635cc502b20a496c56fb93c750f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3.6.0 integrity="sha512-AyDFDkYyALC5qoao077IqAOV7UC4oKCBTp+mJfjIt306AIRoBxoEZYDo0kAx/R7RbT+3EYEky1po/F1w1eQt7g==" crossorigin=anonymous><script defer data-domain=selenium.dev src=https://plausible.io/js/plausible.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand-lg navbar-light bg-white flex-row td-navbar"><a class=navbar-brand href=/pt-br/><span class=navbar-logo><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 139.38 34"><defs><style>.cls-1{fill:#43b02a}</style></defs><title>Selenium logo green</title><path class="cls-1" d="M46.2 26.37a18.85 18.85.0 01-2.57-.2 25 25 0 01-2.74-.53v-1.39a25.31 25.31.0 002.71.53 18 18 0 002.5.2 5.51 5.51.0 003.29-.84 2.79 2.79.0 001.14-2.39 2.85 2.85.0 00-1.24-2.49A6 6 0 0048 18.55q-.78-.29-1.67-.55A15.93 15.93.0 0144 17.13a5.92 5.92.0 01-1.58-1.05 3.6 3.6.0 01-.9-1.34A5 5 0 0141.23 13a4.46 4.46.0 01.41-1.93 4.31 4.31.0 011.17-1.5 5.26 5.26.0 011.82-1A8 8 0 0147 8.28a20.51 20.51.0 014.41.57v1.42a20 20 0 00-2.23-.44 15.2 15.2.0 00-2-.15 4.86 4.86.0 00-3.08.9A2.9 2.9.0 0042.88 13a3.25 3.25.0 00.21 1.21 2.61 2.61.0 00.7 1 4.83 4.83.0 001.27.79 14.31 14.31.0 002 .68q1.11.33 2.06.71a6.21 6.21.0 011.65.94 4.09 4.09.0 011.1 1.38 4.54 4.54.0 01.4 2 4.15 4.15.0 01-1.56 3.48A7.16 7.16.0 0146.2 26.37z"/><path class="cls-1" d="M60.62 26.32a5.46 5.46.0 01-4.28-1.62A6.9 6.9.0 0154.88 20a7.8 7.8.0 011.43-5 5 5 0 014.14-1.75 4.24 4.24.0 013.47 1.43A6.48 6.48.0 0165.1 18.8q0 .54.0.92a3.22 3.22.0 01-.09.64H56.44a5.39 5.39.0 001.17 3.5A4.18 4.18.0 0060.8 25a10.52 10.52.0 001.82-.17 11.77 11.77.0 001.93-.52l.12 1.27a10.68 10.68.0 01-2 .55A11.47 11.47.0 0160.62 26.32zM60.4 14.43q-3.68.0-3.94 4.74h7.15a6.49 6.49.0 00-.78-3.63A2.76 2.76.0 0060.4 14.43z"/><path class="cls-1" d="M68.64 7h1.58V26.11H68.64z"/><path class="cls-1" d="M79.56 26.32a5.46 5.46.0 01-4.28-1.62A6.9 6.9.0 0173.83 20a7.8 7.8.0 011.43-5 5 5 0 014.14-1.75 4.24 4.24.0 013.47 1.43A6.48 6.48.0 0184 18.8q0 .54.0.92a3.22 3.22.0 01-.09.64H75.38a5.4 5.4.0 001.17 3.5A4.18 4.18.0 0079.75 25a10.52 10.52.0 001.82-.17 11.8 11.8.0 001.93-.52l.12 1.27a10.68 10.68.0 01-2 .55A11.47 11.47.0 0179.56 26.32zm-.21-11.89q-3.68.0-3.94 4.74h7.15a6.49 6.49.0 00-.78-3.63A2.76 2.76.0 0079.35 14.43z"/><path class="cls-1" d="M87.51 13.37h1.32l.12 1.49h.12q.94-.45 1.72-.78t1.43-.54a8.42 8.42.0 011.2-.31 6.54 6.54.0 011.1-.09A3.3 3.3.0 0197 14a3.63 3.63.0 01.83 2.63v9.51H96.24v-9a3 3 0 00-.55-2 2.18 2.18.0 00-1.69-.6 7.25 7.25.0 00-2.24.41 20.1 20.1.0 00-2.67 1.12v10H87.51z"/><path class="cls-1" d="M102.75 10.52a.93.93.0 01-1.06-1 1.06 1.06.0 012.12.0.93.93.0 01-1.06 1zm-.8 2.85h1.58V26.11h-1.58z"/><path class="cls-1" d="M110.81 26.34q-3.14.0-3.14-3.47v-9.5h1.58v9a3.16 3.16.0 00.48 2 1.92 1.92.0 001.59.6 6.83 6.83.0 002.48-.48q1.25-.48 2.59-1.14V13.37H118V26.11h-1.32l-.12-1.58h-.09l-1.73.81q-.74.34-1.38.57a7.9 7.9.0 01-1.23.33A7.34 7.34.0 01110.81 26.34z"/><path class="cls-1" d="M122.18 13.37h1.3l.14 1.49h.09a19.53 19.53.0 012.58-1.31 5.51 5.51.0 012-.41 2.83 2.83.0 013 1.77h.12q.8-.5 1.45-.83a12.61 12.61.0 011.2-.54 6.17 6.17.0 011-.31 5.18 5.18.0 011-.09 3.3 3.3.0 012.45.84 3.63 3.63.0 01.83 2.63v9.51h-1.56v-9a2.9 2.9.0 00-.55-2 2.21 2.21.0 00-1.69-.59 5.14 5.14.0 00-1.78.38A14.45 14.45.0 00131.6 16v10.1H130v-9a2.9 2.9.0 00-.55-2 2.21 2.21.0 00-1.69-.59 5.24 5.24.0 00-1.86.4A14 14 0 00123.76 16V26.11h-1.58z"/><path class="cls-1" d="M21.45 21.51a2.49 2.49.0 00-2.55 2.21.08.08.0 00.08.1h4.95a.08.08.0 00.08-.09 2.41 2.41.0 00-2.56-2.22z"/><path class="cls-1" d="M32.06 4.91 21.56 16.7a.32.32.0 01-.47.0l-5.36-5.53a.32.32.0 010-.4L17.5 8.5a.32.32.0 01.52.0l3 3.32a.32.32.0 00.49.0L29.87.36A.23.23.0 0029.69.0H.25A.25.25.0 000 .25v33.5A.25.25.0 00.25 34h32a.25.25.0 00.25-.25V5.06A.23.23.0 0032.06 4.91zm-23 25.36a8.08 8.08.0 01-5.74-2 .31.31.0 010-.41l1.25-1.75A.31.31.0 015 26a6.15 6.15.0 004.2 1.64c1.64.0 2.44-.76 2.44-1.56.0-2.48-8.08-.78-8.08-6.06.0-2.33 2-4.27 5.32-4.27a7.88 7.88.0 015.25 1.76.31.31.0 010 .43L12.9 19.65a.31.31.0 01-.45.05 6.08 6.08.0 00-3.84-1.32c-1.28.0-2 .57-2 1.41.0 2.23 8.06.74 8.06 6C14.67 28.33 12.84 30.27 9.05 30.27zM26.68 25.4a.27.27.0 01-.28.28H19a.09.09.0 00-.08.1 2.81 2.81.0 003 2.32 4.62 4.62.0 002.56-.84.27.27.0 01.4.06l.9 1.31a.28.28.0 01-.06.37 6.67 6.67.0 01-4.1 1.28 5.28 5.28.0 01-5.57-5.48 5.31 5.31.0 015.4-5.46c3.11.0 5.22 2.33 5.22 5.74z"/></svg></span>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=main_navbar><ul class="navbar-nav mr-4 mb-2 mb-lg-0 ps-4 ps-lg-2"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/pt-br/about>About Selenium</a>
<a class=dropdown-item href=/pt-br/project>Structure and Governance</a>
<a class=dropdown-item href=/pt-br/events>Events</a>
<a class=dropdown-item href=/pt-br/ecosystem>Ecosystem</a>
<a class=dropdown-item href=/pt-br/history>History</a>
<a class=dropdown-item href=/pt-br/getinvolved>Get Involved</a>
<a class=dropdown-item href=/pt-br/sponsors>Sponsors</a>
<a class=dropdown-item href=/pt-br/sponsor>Sponsor Us</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pt-br/downloads><span>Downloads</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pt-br/documentation><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pt-br/projects><span>Projects</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pt-br/support><span>Support</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/pt-br/blog><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Português (Brasileiro)</a><ul class=dropdown-menu><li><a class=dropdown-item href=/documentation/grid/>English</a></li><li><a class=dropdown-item href=/zh-cn/documentation/grid/>中文简体</a></li><li><a class=dropdown-item href=/ja/documentation/grid/>日本語</a></li></ul></div></li></ul><div class=navbar-nav><div class=td-search><div class=td-search--algolia id=docsearch-1></div></div></div></div></nav><section id=announcement-banner class="alert-static g-0 row -bg-selenium-blue"><div class="container g-0" style=padding:10px><div class="row g-0 justify-content-center"><div class="alert alert-selenium-blue col-12 fade show mb-0 p-0 -bg-selenium-blue" role=alert><h4 class="alert-heading text-center m-2">Registrations Open for SeleniumConf 2025 | March 26–28 | Join Us In-Person!
<a href="https://seleniumconf.com/?utm_medium=Referral&utm_source=selenium.dev&utm_campaign=register" target=_blank aria-pressed=true>Register now!</a></h4></div></div></div></section></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/pt-br/documentation/grid/>Return to the regular view of this page</a>.</p></div><h1 class=title>Grid</h1><div class=lead>Pretende executar testes em paralelo em várias máquinas? Então a Grid é para si.</div><ul><li>1: <a href=#pg-75ab41fb11e05c56b77cec734372ce26>Configurando a sua</a></li><li>2: <a href=#pg-473c3ba9a1648a779746261bd023b3f4>Quando usar a Grid</a></li><li>3: <a href=#pg-b523d0ca8ce055224f37be89f8083fc0>Componentes</a></li><li>4: <a href=#pg-b1c6192513676fb6014aaa94cca41a86>Configurando componentes</a></li><ul><li>4.1: <a href=#pg-87c07f7cc7b198a46952084fd2e170cb>Ajuda de configuração</a></li><li>4.2: <a href=#pg-fb1445fa9df303a9961b39fa99116b7a>Opções CLI</a></li><li>4.3: <a href=#pg-b112688e72f40f34b417d747cee9d825>Toml Options</a></li></ul><li>5: <a href=#pg-cf345e864afd2cccb282c4c5d3e03055>Arquitectura da Grid</a></li><li>6: <a href=#pg-0a55bd7bbf52302fce2db52de9355fdd>Características avançadas</a></li><ul><li>6.1: <a href=#pg-0559dcb12b1e3ebb50211585a83e0be8>Observabilidade</a></li><li>6.2: <a href=#pg-2c82ff996091dc1dd2f15b718d6b1ede>Suporte a buscas em GraphQL</a></li><li>6.3: <a href=#pg-d2d54c4f08eb016972465f2a03ead126>Rotas da Grid</a></li><li>6.4: <a href=#pg-f1b80d80b2bcdc1e194f0d4fc033093e>Personalizando um Nó</a></li><li>6.5: <a href=#pg-538b88406bce5817973473bd612380c3>External datastore</a></li></ul></ul><div class=content><p>Selenium Grid permite a execucão de scripts WebDriver em máquinas remotas,
passando os comandos recebidos pelo cliente para a instância remotas do navegador.</p><p>O objectivo da Grid é:</p><ul><li>Providenciar uma forma fácil de executar testes em paralelo em multiplas máquinas</li><li>Permitir testes em versões diferentes de navegadores</li><li>Permitir testes em várias plataformas</li></ul><p>Está interessado? Enão siga lendo as próximas secções para entender como a Grid funciona
e também como montar a sua.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-75ab41fb11e05c56b77cec734372ce26>1 - Configurando a sua</h1><div class=lead>Instruções para criar uma Selenium Grid simples</div><h2 id=início-rápido>Início rápido</h2><ol><li>Pré-requisitos<ul><li>Java 11 ou superior instalado</li><li>Navegador(es) instalados</li><li>Drivers do(s) navegador(es)<ul><li><a href=https://www.selenium.dev/pt-br/documentation/selenium_manager/>Selenium Manager</a> will configure the drivers automatically if you add <code>--selenium-manager true</code>.</li><li><a href=https://www.selenium.dev/pt-br/documentation/webdriver/troubleshooting/errors/driver_location/#use-the-path-environment-variable>Installed and on the <code>PATH</code></a></li></ul></li><li>Obter o ficheiro Selenium Server Jar a partir da <a href=https://github.com/SeleniumHQ/selenium/releases/latest>última release</a></li></ul></li><li>Iniciar a Grid<ul><li><code>java -jar selenium-server-&lt;version>.jar standalone</code></li></ul></li><li>Aponte* os seus testes WebDriver para <a href=http://localhost:4444>http://localhost:4444</a></li><li>(Opcional) Verifique os testes que estão em execução abrindo o navegador em <a href=http://localhost:4444>http://localhost:4444</a></li></ol><p>*Se quer saber como direcionar os seus testes para <a href=http://localhost:4444>http://localhost:4444</a>, veja a secção <a href=https://www.selenium.dev/pt-br/documentation/webdriver/drivers/#remote-webdriver><code>RemoteWebDriver</code></a>.</p><p>Para aprender mais sobre as diferentes opções de configuração, veja as secções seguintes.</p><h2 id=grid-roles>Grid roles</h2><p>A Grid é composta de seis <a href=https://www.selenium.dev/pt-br/documentation/grid/components/>componentes</a> diferentes, o que permite ser
instalada de várias formas.</p><p>Dependendo das necessidades, podemos iniciar cada um dos componentes (Distribuido) ou agrupar no formato
Hub e Node ou ainda numa única máquina (Standalone).</p><h3 id=standalone>Standalone</h3><p><strong>Standalone</strong> combina todos os <a href=https://www.selenium.dev/pt-br/documentation/grid/components/>componentes</a> num só sitio.
Executar uma Grid em modo <strong>Standalone</strong> permite uma Grid totalmente funcionar com um único
comando, num único processo. <strong>Standalone</strong> só funcionará numa única máquina.</p><p><strong>Standalone</strong> é também a forma mais simples de colocar uma Selenium Grid em funcionamento.
Por omissão, o servidor irá escutar por pedidos <code>RemoteWebDriver</code> em <a href=http://localhost:4444>http://localhost:4444</a>.
O servidor irá também detectar os drivers disponíveis no
<a href=https://www.selenium.dev/pt-br/documentation/webdriver/troubleshooting/errors/driver_location/#3-a-variável-de-ambiente--path><code>PATH</code></a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar standalone
</span></span></code></pre></div><p>Após iniciar a Selenium Grid no modo Standalone, aponte os seus WebDriver tests para
<a href=http://localhost:4444>http://localhost:4444</a>.</p><p>Alguns casos de uso para <strong>Standalone</strong> são:</p><ul><li>Desenvolver ou debugar testes usando <code>RemoteWebDriver</code> localmente</li><li>Executar baterias de testes rapidamente antes de fazer commit de código</li><li>Ter uma Grid simples de montar numa ferramenta CI/CD (GitHub Actions, Jenkins, etc&mldr;)</li></ul><h3 id=hub-e-node>Hub e Node</h3><p><strong>Hub e Node</strong> é uma das formas mais usadas porque permite:</p><ul><li>Combinar máquinas diferentes na mesma Grid<ul><li>Máquinas com sistemas operativos diferentes e/ou versões de navegadores diferentes</li></ul></li><li>Ter um ponto único de entrada para executar testes WebDriver em ambientes diferentes</li><li>Escalar a capacidade para cima ou para baixo sem ter que parar a Grid</li></ul><h4 id=hub>Hub</h4><p>O Hub é composto pelos seguintes <a href=https://www.selenium.dev/pt-br/documentation/grid/components/>componentes</a>:
Router, Distributor, Session Map, New Session Queue, e Event Bus.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar hub
</span></span></code></pre></div><p>Por omissão, o servidor irá estar à escuta por pedidos de sessão <code>RemoteWebDriver</code> em <a href=http://localhost:4444>http://localhost:4444</a>.</p><h4 id=node>Node</h4><p>Ao iniciar, o <strong>Node</strong> irá detectar os drivers disponíveis através do
<a href=https://www.selenium.dev/pt-br/documentation/webdriver/troubleshooting/errors/driver_location/#3-a-variável-de-ambiente--path><code>PATH</code></a>.</p><p>O comando exemplo seguinte assume que o <strong>Node</strong> está a executar na mesma máquina onde o <strong>Hub</strong> está em execução.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node
</span></span></code></pre></div><h5 id=mais-do-que-um-node-na-mesma-máquina>Mais do que um Node na mesma máquina</h5><p><strong>Node</strong> 1</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --port <span style=color:#0000cf;font-weight:700>5555</span>
</span></span></code></pre></div><p><strong>Node</strong> 2</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --port <span style=color:#0000cf;font-weight:700>6666</span>
</span></span></code></pre></div><h5 id=node-e-hub-em-máquinas-diferentes>Node e Hub em máquinas diferentes</h5><p>A comunicação entre <strong>Hub</strong> e <strong>Nodes</strong> ocorre via HTTP. Para iniciar o processo de registo, o <strong>Node</strong> envia
uma mensagem para o <strong>Hub</strong> através do <a href=https://www.selenium.dev/pt-br/documentation/grid/components/#event-bus><strong>Event Bus</strong></a>
(o <strong>Event Bus</strong> reside dentro do <strong>Hub</strong>). Quando o <strong>Hub</strong> recebe a mensagem, tenta comunicar com o <strong>Node</strong>
para confirmar a sua existencia.</p><p>Para que um <strong>Node</strong> se consiga registar no <strong>Hub</strong>, é importante que as portas do <strong>Event Bus</strong> sejam expostas
na máquina <strong>Hub</strong>. As portas por omissão são 4442 e 4443 para o <strong>Event Bus</strong> e 4444 para o <strong>Hub</strong>.</p><p>Se o <strong>Hub</strong> estiver a usar as portas por omissão, pode usar a flag <code>--hub</code> para registar o <strong>Node</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --hub http://&lt;hub-ip&gt;:4444
</span></span></code></pre></div><p>Quando o <strong>Hub</strong> não estiver a usar as portas por omissão, necessita usar as flags<code>--publish-events</code> e <code>--subscribe-events</code>.</p><p>Por exemplo, se o <strong>Hub</strong> usar as portas<code>8886</code>, <code>8887</code>, e <code>8888</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar hub --publish-events tcp://&lt;hub-ip&gt;:8886 --subscribe-events tcp://&lt;hub-ip&gt;:8887 --port <span style=color:#0000cf;font-weight:700>8888</span>
</span></span></code></pre></div><p>O <strong>Node</strong> necessita de especificar as portas para conseguir registar-se com sucesso</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --publish-events tcp://&lt;hub-ip&gt;:8886 --subscribe-events tcp://&lt;hub-ip&gt;:8887
</span></span></code></pre></div><h3 id=distribuida>Distribuida</h3><p>Quando usar uma Grid distribuida, cada componente é iniciado separadamente e preferencialmente em máquinas diferentes.</p><div class="alert alert-primary" role=alert>É de extrema importância expor todas as portas necessárias de forma a que a comunicação flua correctamente entre todos os componentes.</div><ol><li><strong>Event Bus</strong>: permite comunicação interna entre os diferentes componentes da Grid.</li></ol><p>As portas por omissão são: <code>4442</code>, <code>4443</code>, and <code>5557</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar event-bus --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443 --port <span style=color:#0000cf;font-weight:700>5557</span>
</span></span></code></pre></div><ol start=2><li><strong>New Session Queue</strong>: adiciona novos pedidos de sessão a uma queue, que serão consultadas pelo Distributor</li></ol><p>A porta por omissão é <code>5559</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span>
</span></span></code></pre></div><ol start=3><li><strong>Session Map</strong>: estabelece um mapa entre id de sessão e o <strong>Node</strong> onde a sessão está a executar</li></ol><p>A porta por omissão é <code>5556</code>. <strong>Session Map</strong> interage com o <strong>Event Bus</strong>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessions --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443 --port <span style=color:#0000cf;font-weight:700>5556</span>
</span></span></code></pre></div><ol start=4><li><strong>Distributor</strong>: consulta <strong>New Session Queue</strong> para novos pedidos de sessão, que entrega ao um <strong>Node</strong> quando encontra um capacidade
correspondente. <strong>Nodes</strong> registam-se no <strong>Distributor</strong> da mesma forma como numa Grid do tipo <strong>Hub/Node</strong>.</li></ol><p>A porta por omissão é <code>5553</code>. <strong>Distributor</strong> interage com <strong>New Session Queue</strong>, <strong>Session Map</strong>, <strong>Event Bus</strong>, e <strong>Node(s)</strong>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar distributor --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443 --sessions http://&lt;sessions-ip&gt;:5556 --sessionqueue http://&lt;new-session-queue-ip&gt;:5559 --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span>
</span></span></code></pre></div><ol start=5><li><strong>Router</strong>: redirecciona novos pedidos de sessão para a queue, e redirecciona pedidos de sessões para o <strong>Node</strong> que estiver a executar a sessão.</li></ol><p>A porta por omissão é <code>4444</code>. <strong>Router</strong> interage com <strong>New Session Queue</strong>, <strong>Session Map</strong>, e <strong>Distributor</strong>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar router --sessions http://&lt;sessions-ip&gt;:5556 --distributor http://&lt;distributor-ip&gt;:5553 --sessionqueue http://&lt;new-session-queue-ip&gt;:5559 --port <span style=color:#0000cf;font-weight:700>4444</span>
</span></span></code></pre></div><ol start=6><li><strong>Node(s)</strong></li></ol><p>A porta por omissão é <code>5555</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --publish-events tcp://&lt;event-bus-ip&gt;:4442 --subscribe-events tcp://&lt;event-bus-ip&gt;:4443
</span></span></code></pre></div><h2 id=adicionar-metadata-nos-testes>Adicionar Metadata nos testes</h2><p>Adicione Metadata aos testes, através de <a href=https://www.selenium.dev/pt-br/documentation/grid/advanced_features/graphql_support/>GraphQL</a>
ou visualize parcialmente (como <code>se:name</code>) através da Selenium Grid UI.</p><p>Metadata pode ser adicionada como uma capacidade com o prefixo <code>se:</code>. Eis um pequeno exemplo em Java.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>ChromeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>chromeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ChromeOptions</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>chromeOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;browserVersion&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;100&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>chromeOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;platformName&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Windows&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Mostrando na Grid UI o nome de um teste ao invés de uma session id</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>chromeOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:name&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;My simple test&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Outros tipos de metadara podem ser visualizados na Grid UI </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// ao clicar na informação de sessão ou via GraphQL</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>chromeOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:sampleMetadata&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Valor exemplo de Metadata&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>WebDriver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>driver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RemoteWebDriver</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URL</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://gridUrl:4444&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>chromeOptions</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://www.google.com&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=questionando-a-selenium-grid>Questionando a Selenium Grid</h2><p>Após iniciar a Gris, existem duas formas de saber o seu estado, através da Grid UI ou
por chamada API.</p><p>A Grid UI pode ser acedida pelo seu navegador preferido em <a href=http://localhost:4444>http://localhost:4444</a>.
As chamadas API podem ser feitas para o endpoint <a href=http://localhost:4444/status>http://localhost:4444/status</a> ou
através de <a href=https://www.selenium.dev/pt-br/documentation/grid/advanced_features/graphql_support/>GraphQL</a>.</p><div class="pageinfo pageinfo-primary"><p>Para simplificar, todos os exemplos apresentados assumem que os componentes estão a ser executados localmente.
Exemplos mais detalhados podem ser encontrados na secção <a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/>Configurando Componentes</a>.</p></div><h2 id=usando-o-cliente-http-nativo-java-11>Usando o cliente HTTP nativo Java 11</h2><p><a href=https://github.com/SeleniumHQ/selenium/releases/tag/selenium-4.5.0><span class=selenium-badge-version data-bs-toggle=tooltip data-bs-placement=right title="This code requires Selenium v4.5 or greater">Selenium v4.5</span></a></p><p>Por omissão, a Grid irá usar <a href=https://github.com/AsyncHttpClient/async-http-client>AsyncHttpClient</a>.
AsyncHttpClient é uma biblioteca open-source library criada em cima do Netty. Isto permite a
execução de pedidos e respostas HTTP de forma assíncrona. Esta biblioteca é uma boa escolha
pois além de permitir pedidos assíncronos, também suporta WebSockets.</p><p>No entanto, a biblioteca AsyncHttpClient não é mantida activamente desde Junho de 2021. Isto coincide com
o facto de que a partir do Java 11, a JVM tem um cliente nativo que suporta camadas assíncronas
e contém um cliente WebSocket.</p><p>Atualmente, o projecto Selenium tem planos de atualizar a versão mínima suportada para Java 11.
No entanto, isto é um esforço considerável. Alinhá-lo com os principais lançamentos e anúncios
acompanhados é crucial para garantir que a experiência do usuário esteja intacta.</p><p>Para usar o cliente Java 11, terá que baixar o ficheiro jar <code>selenium-http-jdk-client</code> e usar
a flag <code>--ext</code> para funcionar na Grid.</p><p>Este ficheiro pode ser obtido directamente de <a href=https://repo1.maven.org/maven2/org/seleniumhq/selenium/selenium-http-jdk-client/>repo1.maven.org</a>
e depois pode iniciar a Grid com:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -Dwebdriver.http.factory<span style=color:#ce5c00;font-weight:700>=</span>jdk-http-client -jar selenium-server-&lt;version&gt;.jar --ext selenium-http-jdk-client-&lt;version&gt;.jar standalone
</span></span></code></pre></div><p>Uma alternativa a baixar o ficheiro jar <code>selenium-http-jdk-client</code> é usar <a href=https://get-coursier.io/docs/cli-installation>Coursier</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -Dwebdriver.http.factory<span style=color:#ce5c00;font-weight:700>=</span>jdk-http-client -jar selenium-server-&lt;version&gt;.jar --ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-http-jdk-client:&lt;version&gt;<span style=color:#204a87;font-weight:700>)</span> standalone
</span></span></code></pre></div><p>Se está a usar a Grid em modo <strong>Hub/Node</strong> ou <strong>Distributed</strong>, terá que usar as flags
<code>-Dwebdriver.http.factory=jdk-http-client</code> e <code>--ext</code> em cada um dos componentes.</p><h2 id=dimensionar-grid>Dimensionar Grid</h2><p>A escolha de Grid depende de quais sistemas operacionais e navegadores precisam ser suportados,
quantas sessões paralelas precisam ser executadas, a quantidade de máquinas disponíveis e quão
poderosas (CPU, RAM) essas máquinas são.</p><p>A criação de sessões simultaneas depende dos processadores disponíveis para o <strong>Distributor</strong>.
Por exemplo, se uma máquina tiver 4 CPUs, o <strong>Distributor</strong> só poderá criar quatro sessões
em simultâneo.</p><p>Por omissão, a quantidade máxima de sessões simultâneas que um <strong>Node</strong> suporta é limitada pelo
número de CPUs disponíveis. Por exemplo, se a máquina <strong>Node</strong> tiver 8 CPUs, ela poderá executar
até 8 sessões de navegador simultâneas (com exceção do Safari, que é sempre uma).
Além disso, espera-se que cada sessão do navegador use cerca de 1 GB de RAM.</p><p>Em geral, é recomendado ter <strong>Nodes</strong> o mais pequenos possíveis. Em vez de ter
uma máquina com 32CPUs e 32GB de RAM para executar 32 sessões de navegador simultâneas, é melhor
tem 32 pequenos <strong>Nodes</strong> para isolar melhor os processos. Com isso, se um <strong>Node</strong>
falhar, será de forma isolada. Docker é uma boa ferramenta para alcançar essa abordagem.</p><p>Note que os valores 1CPU/1GB RAM por navegador são uma recomendação e podem não ser os mais indicados
para o seu contexto. Recomenda-se que use estea valores como referência, mas meça o desempenho
continuamente para ajudar a determinar os valores ideais para o seu ambiente.</p><p>Os tamanhos da Grid são relativos à quantidade de sessões simultâneas suportadas e à quantidade de
<strong>Nodes</strong>, não existindo um &ldquo;tamanho único&rdquo;. Os tamanhos mencionados abaixo são estimativas aproximadas
que podem variar entre diferentes ambientes. Por exemplo, um <strong>Hub/Node</strong> com 120 <strong>Nodes</strong>
pode funcionar bem quando o <strong>Hub</strong> tiver recursos suficientes. Os valores abaixo não são gravados em pedra,
e comentários são bem-vindos!</p><h3 id=pequena>Pequena</h3><p><strong>Standalone</strong> e <strong>Hub/Node</strong> com cinco <strong>Nodes</strong> ou menos.</p><h3 id=média>Média</h3><p><strong>Hub/Node</strong> entre 6 e 60 <strong>Nodes</strong>.</p><h3 id=grande>Grande</h3><p><strong>Hub/Node</strong> entre 60 e 100 <strong>Nodes</strong>. <strong>Distributed</strong> com mais de 100 <strong>Nodes</strong>.</p><h2 id=aviso>AVISO</h2><p>Deve proteger a Selenium Grid de acesso externo, usando regras de firewall apropriadas.</p><p>Se falhar em proteger a Grid uma ou mais coisas poderão ocorrer:</p><ul><li>Permite acesso aberto à sua infraestrutura da Grid</li><li>Permitir acesso de terceiros a aplicativos web e a ficheiros</li><li>Permitir execução remota de ficheiros binários por terceiros</li></ul><p>Leia este artigo (em Inglês) em <a href=/pt-br/>Detectify</a>, que dá um bom resumo
de como uma Grid exposta publicamente pode ser abusada:
<a href=//labs.detectify.com/2017/10/06/guest-blog-dont-leave-your-grid-wide-open/>Don&rsquo;t Leave your Grid Wide Open</a></p><h2 id=leituras-adicionais>Leituras adicionais</h2><ul><li><a href=https://www.selenium.dev/pt-br/documentation/grid/components/>Componentes</a>: compreender como usar os componentes da Grid</li><li><a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/>Configuração</a>: personalize a sua configuração Grid.</li><li><a href=https://www.selenium.dev/pt-br/documentation/grid/architecture/>Arquitectura</a>: entenda conceitos chave da Grid.</li><li><a href=https://www.selenium.dev/pt-br/documentation/grid/advanced_features/>Advanced Features</a>: explore mais possibilidades da Grid.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-473c3ba9a1648a779746261bd023b3f4>2 - Quando usar a Grid</h1><div class=lead>Será a Grid a melhor escolha para você?</div><p>Quando deve usar a Selenium Grid?</p><ul><li>Para executar testes em paralelo, com vários tipos e versões de navegador e sistemas operativos</li><li>Para reduzir o tempo necessário a executar uma bateria de testes</li></ul><p>A Selenium Grid executa baterias de testes em paralelo contra várias máquinas (chamadas Nodes).
Para testes longos, isto poderá poupar minutos, horas e talvez dias.
Isto encurta o tempo de espera para obter resultados dos testes de cada vez que sobre a aplicação
em testes é alterada.</p><p>A Grid consegue executar testes (em paralelo) contra multiplos e diferentes navegadores, também
é capaz de executar contra várias instâncias do mesmo navegador. Como exemplo, vamos imaginar
uma Grid com seis Nodes. A primeira máquina tem a versão mais recente do Firefox, a segunda tem
a versão &ldquo;mais recente -1&rdquo;, a terceira tem o Chrome mais recente e as restantes máquinas são Mac
Mini, que permitem três testes em paralelo com a versão mais recente to Safari.</p><p>O tempo de execução pode ser expresso como uma fórmula simples:</p><p><code>Número de testes * Tempo médio de cada teste / Número de Nodes = Tempo total de execução</code></p><pre><code>   15      *       45s        /        1        =      11m 15s   // Sem Grid
   15      *       45s        /        5        =      2m 15s    // Grid com 5 Nodes
   15      *       45s        /        15       =      45s       // Grid com 15 Nodes
  100      *       120s       /        15       =      13m 20s   // Demoraria mais de 3 horas sem Grid
</code></pre><p>À medida que a bateria de testes executa, a Grid vai alocando os testes contra estes navegadores
como está definido nos testes.</p><p>Uma configuração deste tipo pode acelerar bastante o tempo de execução mesmo no caso de baterias de testes grandes.</p><p>A Selenium Grid é uma parte integrante do projecto Selenium e é mantida em paralelo pela mesma equipa de developers
que desenvolvem o resto das funcionalidades base do projecto. Dada a importância da velocidade e desempenho da
execução dos testes, a Grid tem sido considerada desde o início como uma parte crítica e fundamental ao projecto.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b523d0ca8ce055224f37be89f8083fc0>3 - Componentes</h1><div class=lead>Compreender como usar os componentes da Grid</div><p>A Selenium Grid 4 é uma re-escrita completa das versões anteriores. Além dos melhoramentos ao desempenho
e aos cumprimentos dos standards, várias funcionalidades da Grid foram separadas para reflectir uma
nova era de computação e desenvolvimento de software. Criada de raíz para containerização e
escalabilidade cloud, Selenium Grid 4 é uma nova solução para a era moderna.</p><p><img alt="Selenium Grid 4 Components" src=/images/documentation/grid/components.png></p><h2 id=router>Router</h2><p>O <strong>Router</strong> é o ponto de entrada da Grid, recebendo todos os pedidos externos, reenviando para o componente correcto.</p><p>Se o <strong>Router</strong> recebe um novo pedido de sessão, este será enviado para <strong>New Session Queue</strong>.</p><p>Se o pedido recebido pertence a uma sessão existente, o <strong>Router</strong> irá inquirir o <strong>Session Map</strong> para obter
o <strong>Node</strong> ID onde esta sessão está em execução, enviando de seguida o pedido directamente para o <strong>Node</strong>.</p><p>O <strong>Router</strong> balança a carga na Grid ao enviar o pedido ao componente que está em condições de o receber,
sem sobrecarregar qualquer outro componente que não faz parte do processo.</p><h2 id=distributor>Distributor</h2><p>O <strong>Distributor</strong> tem duas responsabilidades:</p><h4 id=resgistar-e-manter-uma-lista-de-todos-os-nodes-e-as-suas-capacidades>Resgistar e manter uma lista de todos os Nodes e as suas capacidades</h4><p>Um <strong>Node</strong> regista-se no <strong>Distributor</strong> enviando um evento de registo <strong>Node</strong> através do
<strong>Event Bus</strong>. O <strong>Distributor</strong> lê o pedido e tenta contactar o <strong>Node</strong> através de HTTP
para confirmar a sua existência. Se obtiver resposta com sucesso, o <strong>Distributor</strong> regista
o Node e mantém uma lista de todas as capacidades <strong>Nodes</strong> através do <strong>GridModel</strong>.</p><h4 id=processar-algum-pedido-pendente-que-tenha-sido-criado-na-new-session-queue>Processar algum pedido pendente que tenha sido criado na New Session Queue</h4><p>Quando um novo pedido de sessão é enviado para o <strong>Router</strong>, ele é reenviado para a <strong>New Session Queue</strong>,
onde ficará na fila em espera. O <strong>Distributor</strong> irá processar pedidos pendentes que existam na <strong>New Session Queue</strong>,
encontrando um <strong>Node</strong> com as capacidades certas onde a sessão possa ser criada. Após esta nova
sessão ter sido criada, o <strong>Distributor</strong> guarda na <strong>Session Map</strong> a relação entre o id da sessão e
o <strong>Node</strong> onde a sessão está em execução.</p><h2 id=session-map>Session Map</h2><p>A <strong>Session Map</strong> é uma data store que mantém a relação entre o id da sessão e o <strong>Node</strong>
onde a sessão está em execução. Apoia o <strong>Router</strong> no processo de envio do pedido para um <strong>Node</strong>
onde a sessão está em execução. O <strong>Router</strong> irá pedir ao <strong>Session Map</strong> qual o <strong>Node</strong> associado
ao id de sessão.</p><h2 id=new-session-queue>New Session Queue</h2><p>A <strong>New Session Queue</strong> contém todos os pedidos de novas sessões em ordem FIFO. Existem parametros
configuráveis para o timeout de sessão e para o número de tentativas.</p><p>O <strong>Router</strong> adiciona um novo pedido de sessão em <strong>New Session Queue</strong> e aguarda uma resposta.
A <strong>New Session Queue</strong> verifica regularmente se algum pedido deu timeout e em caso afirmativo,
rejeita e remove o pedido da queue.</p><p>O <strong>Distributor</strong> verifica regularmente se existe um slot disponível. Em caso afirmativo, o <strong>Distributor</strong>
obtém um pedido a partir de <strong>New Session Queue</strong> e tenta criar uma nova sessão.</p><p>Assim que existam capacidades pedidas capazes de serem servidas por um dos <strong>Node</strong> que estejam livres,
o <strong>Distributor</strong> tenta obter o slot disponível. Caso todos os slots estejam ocupados, o <strong>Distributor</strong>
envia o pedido de volta para a queue. Se o pedido tiver timeout ao ser readicionado à queue, será rejeitado.</p><p>Após um id de sessão ser criado, o <strong>Distributor</strong> envia a informação se sessão para <strong>New Session Queue</strong>,
que por sua vez irá enviar para o <strong>Router</strong> que finalmente entrega ao cliente.</p><h2 id=node>Node</h2><p>A Grid pode ter múltiplos <strong>Nodes</strong>. Cada <strong>Node</strong> gere os slots de disponibilidade para os navegadores existentes
na máquina onde está a executar.</p><p>O <strong>Node</strong> regista-se no <strong>Distributor</strong> através do <strong>Event Bus</strong>, sendo que a sua configuração é enviada
como parte da mensagem de registo.</p><p>Por omissão, o <strong>Node</strong> regista automaticamente todos os navegadores que estejam disponíveis no PATH da máquina onde
executa. Cria também um slot de execução por cada CPU para os navegadores Chrome e Firefox. Para Safari,
apenas é criado um slot. Usando uma <a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/>configuração</a> específica, é também
possível executar sessões em containers Docker.</p><p>O <strong>Node</strong> apenas executa os comandos que recebe, não avalia, faz julgamentos ou controla mais nada que não seja
o fluxo de comandos e respostas. A máquina onde o <strong>Node</strong> está a executar não necessita de ter o mesmo sistema
operativo do que os restantes componentes. Por exemplo, um Windows <strong>Node</strong> pode ter a capacidade de oferecer
IE Mode no Edge como opção de navegador, coisa que não é possível em Linux ou Mac. A Grid pode ter múltiplos
<strong>Node</strong> configurados com Windows, Mac ou Linux.</p><h2 id=event-bus>Event Bus</h2><p>O <strong>Event Bus</strong> serve de canal de comunicações entre <strong>Nodes</strong>, <strong>Distributor</strong>, <strong>New Session Queue</strong>,
e <strong>Session Map</strong>. A Grid usa mensagens para a maioria das comunicações internas. evitando chamadas HTTP.
Quando iniciar a Grid em modo distribuido, deverá iniciar o <strong>Event Bus</strong> antes dos restantes componentes.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Configurando a sua Grid</h4>Se pretende usar todos estes componentes para criar a sua Grid,
visite a secção <a href=https://www.selenium.dev/pt-br/documentation/grid/getting_started/>&ldquo;configurando a sua&rdquo;</a>
para entender como ligar as peças todas.</div></div><div class=td-content style=page-break-before:always><h1 id=pg-b1c6192513676fb6014aaa94cca41a86>4 - Configurando componentes</h1><div class=lead>Leia aqui como pode configurar cada um dos componentes Grid com base em valores comuns ou específicos para o componente.</div></div><div class=td-content><h1 id=pg-87c07f7cc7b198a46952084fd2e170cb>4.1 - Ajuda de configuração</h1><div class=lead>Obtenha ajuda sobre todas as opções disponíveis para configurar a Grid.</div><div class="pageinfo pageinfo-primary"><p>Os comandos de ajuda (help) mostram informação baseada na implementação de código em vigor.
Desta forma, irá obter informação potencialmente mais actual do que esta documentação.
Embora possa não ser a mais detalhada, é sempre a forma mais simples de aprender sobre
as configurações da Grid 4 em qualquer nova versão.</p></div><h2 id=commando-info>Commando info</h2><p>O comando <code>info</code> fornece detalhes de documentação sobre os seguintes tópicos:</p><ul><li>Configurar Selenium</li><li>Segurança</li><li>Setup Session Map</li><li>Traceamento</li></ul><h3 id=ajuda-sobre-configuração>Ajuda sobre configuração</h3><p>Ajuda rápida e resumo pode ser obtida com:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info config
</span></span></code></pre></div><h3 id=segurança>Segurança</h3><p>Para obter detalhes em como configurar os servidores Grid para comunicação segura
e para o registo de <strong>Nodes</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info security
</span></span></code></pre></div><h3 id=configuração-session-map>Configuração Session Map</h3><p>Por omissão, a Grid usa um <code>local session map</code> para armazenar informação de sessões.
A Grid permite armazenamento opcional em Redis ou bancos de dados JDBC SQL.
Para obter informação de como usar, use o seguinte comando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info sessionmap
</span></span></code></pre></div><h3 id=traceamento-com-opentelemetry-e-jaeger>Traceamento com OpenTelemetry e Jaeger</h3><p>Por omissao, traceamento está activo. Para exportar e visualizar através de Jaeger, use o
comando seguinte para instruções de como o efectuar:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar info tracing
</span></span></code></pre></div><h2 id=lista-de-comandos-selenium-grid>Lista de comandos Selenium Grid</h2><p>Irá mostrar todos os comandos disponíveis e também a descrição de cada um.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar --config-help
</span></span></code></pre></div><h2 id=comandos-de-ajuda-para-componente>Comandos de ajuda para componente</h2><p>Adicione <code>--help</code> após o Selenium role para obter informação específica de configuração do componente.</p><h3 id=standalone>Standalone</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar standalone --help
</span></span></code></pre></div><h3 id=hub>Hub</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar hub --help
</span></span></code></pre></div><h3 id=sessions>Sessions</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessions --help
</span></span></code></pre></div><h3 id=new-session-queue>New Session Queue</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar sessionqueue --help
</span></span></code></pre></div><h3 id=distributor>Distributor</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar distributor --help
</span></span></code></pre></div><h3 id=router>Router</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar router --help
</span></span></code></pre></div><h3 id=node>Node</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-&lt;version&gt;.jar node --help
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-fb1445fa9df303a9961b39fa99116b7a>4.2 - Opções CLI</h1><div class=lead>Todas os detalhes das opções CLI de cada componente Grid.</div><p>Diferentes secções estão disponíveis para configurar uma Grid. Cada secção tem opções que podem ser configuradas
através de opções CLI.</p><p>Pode ver abaixo um mapeamento entre o componente e a secção respectiva.</p><div class="pageinfo pageinfo-primary"><p>Note que esta documentação pode estar desactualizada se uma opção foi adicionada ou modificada,
mas ainda não ter havido oportunidade de actualizar a documentação.
Caso depare com esta situação, verifique a secção <a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/help/>&ldquo;ajuda de configuração&rdquo;</a>
e esteja à vontade para nos enviar um pull request com alterações a esta página.</p></div><h2 id=secções>Secções</h2><table class="table table-bordered text-md-center d-md-table-cell"><thead><tr><th></th><th>Standalone</th><th>Hub</th><th>Node</th><th>Distributor</th><th>Router</th><th>Sessions</th><th>SessionQueue</th></tr></thead><tbody><tr><th><a href=#distributor>Distributor</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td></td></tr><tr><th><a href=#docker>Docker</a></th><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td><td></td><td></td></tr><tr><th><a href=#events>Events</a></th><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#logging>Logging</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#network>Network</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td></tr><tr><th><a href=#node>Node</a></th><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td><td></td><td></td></tr><tr><th><a href=#router>Router</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td></tr><tr><th><a href=#relay>Relay</a></th><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td></td><td></td><td></td><td></td></tr><tr><th><a href=#server>Server</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#sessionqueue>SessionQueue</a></th><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td><td><i class="fas fa-check"></i></td></tr><tr><th><a href=#sessions>Sessions</a></th><td></td><td></td><td></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td><i class="fas fa-check"></i></td><td></td></tr></tbody></table><h3 id=distributor>Distributor</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--healthcheck-interval</code></td><td>int</td><td><code>120</code></td><td>Tempo em segundos em que se verifica o estado dos Nodes. Isto garante que o servidor consecontactar cada um dos Nodes com sucesso.</td></tr><tr><td><code>--distributor</code></td><td>uri</td><td><code>http://localhost:5553</code></td><td>Url do Distributor.</td></tr><tr><td><code>--distributor-host</code></td><td>string</td><td><code>localhost</code></td><td>Host onde o Distributor está à escuta.</td></tr><tr><td><code>--distributor-implementation</code></td><td>string</td><td><code>org.openqa.selenium.grid.distributor.local.LocalDistributor</code></td><td>Nome completo da class para uma implementação não padrão do Distributor.</td></tr><tr><td><code>--distributor-port</code></td><td>int</td><td><code>5553</code></td><td>Porta onde o Distributor está à escuta.</td></tr><tr><td><code>--reject-unsupported-caps</code></td><td>boolean</td><td><code>false</code></td><td>Permitir que o Distributor rejeite imediatamente um pedido de sessão se a Grid não suportar a capacidade pedida. Esta configuração é a ideal para Grid que não inicie Nodes a pedido.</td></tr><tr><td><code>--slot-matcher</code></td><td>string</td><td><code>org.openqa.selenium.grid.data.DefaultSlotMatcher</code></td><td>Nome completo da class para uma implementação não padrão do comparador de slots. Isto é usado para determinar se um Node pode suportar uma sessão em particular.</td></tr><tr><td><code>--slot-selector</code></td><td>string</td><td><code>org.openqa.selenium.grid.distributor.selector.DefaultSlotSelector</code></td><td>Nome completo da class para uma implementação não padrão do selector de slots. Isto é usado para selecionar um slot no Node caso tenha sido &ldquo;matched&rdquo;.</td></tr><tr><td><code>--newsession-threadpool-size</code></td><td>int</td><td><code>24</code></td><td>The Distributor uses a fixed-sized thread pool to create new sessions as it consumes new session requests from the queue. This allows configuring the size of the thread pool. The default value is no. of available processors * 3. Note: If the no. of threads is way greater than the available processors it will not always increase the performance. A high number of threads causes more context switching which is an expensive operation.</td></tr></tbody></table><h3 id=docker>Docker</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--docker-assets-path</code></td><td>string</td><td><code>/opt/selenium/assets</code></td><td>Absolute path where assets will be stored</td></tr><tr><td><code>--docker-</code></td><td>string[]</td><td><code>selenium/standalone-firefox:latest '{"browserName": "firefox"}'</code></td><td>Docker configs which map image name to stereotype capabilities (example `-D selenium/standalone-firefox:latest &lsquo;{&ldquo;browserName&rdquo;: &ldquo;firefox&rdquo;}&rsquo;)</td></tr><tr><td><code>--docker-devices</code></td><td>string[]</td><td><code>/dev/kvm:/dev/kvm</code></td><td>Exposes devices to a container. Each device mapping declaration must have at least the path of the device in both host and container separated by a colon like in this example: /device/path/in/host:/device/path/in/container</td></tr><tr><td><code>--docker-host</code></td><td>string</td><td><code>localhost</code></td><td>Host name where the Docker daemon is running</td></tr><tr><td><code>--docker-port</code></td><td>int</td><td><code>2375</code></td><td>Port where the Docker daemon is running</td></tr><tr><td><code>--docker-url</code></td><td>string</td><td><code>http://localhost:2375</code></td><td>URL for connecting to the Docker daemon</td></tr><tr><td><code>--docker-video-image</code></td><td>string</td><td><code>selenium/video:latest</code></td><td>Docker image to be used when video recording is enabled</td></tr><tr><td><code>--docker-host-config-keys</code></td><td>string[]</td><td><code>Dns DnsOptions DnsSearch ExtraHosts Binds</code></td><td>Specify which docker host configuration keys should be passed to browser containers. Keys name can be found in the Docker API <a href=https://docs.docker.com/engine/api/v1.41/#tag/Container/operation/ContainerCreate>documentation</a>, or by running <code>docker inspect</code> the node-docker container.</td></tr></tbody></table><h3 id=events>Events</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--bind-bus</code></td><td>boolean</td><td><code>false</code></td><td>Whether the connection string should be bound or connected.<br>When true, the component will be bound to the Event Bus (as in the Event Bus will also be started by the component, typically by the Distributor and the Hub).<br>When false, the component will connect to the Event Bus.</td></tr><tr><td><code>--events-implementation</code></td><td>string</td><td><code>org.openqa.selenium.events.zeromq.ZeroMqEventBus</code></td><td>Full class name of non-default event bus implementation</td></tr><tr><td><code>--publish-events</code></td><td>string</td><td><code>tcp://*:4442</code></td><td>Connection string for publishing events to the event bus</td></tr><tr><td><code>--subscribe-events</code></td><td>string</td><td><code>tcp://*:4443</code></td><td>Connection string for subscribing to events from the event bus</td></tr></tbody></table><h3 id=logging>Logging</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--http-logs</code></td><td>boolean</td><td><code>false</code></td><td>Enable http logging. Tracing should be enabled to log http logs.</td></tr><tr><td><code>--log-encoding</code></td><td>string</td><td><code>UTF-8</code></td><td>Log encoding</td></tr><tr><td><code>--log</code></td><td>string</td><td>Windows path example :<br><code>'\path\to\file\gridlog.log'</code><br>or<br><code>'C:\path\path\to\file\gridlog.log'</code><br><br>Linux/Unix/MacOS path example :<br><code>'/path/to/file/gridlog.log'</code></td><td>File to write out logs. Ensure the file path is compatible with the operating system&rsquo;s file path.</td></tr><tr><td><code>--log-level</code></td><td>string</td><td><code>“INFO”</code></td><td>Log level. Default logging level is INFO. Log levels are described here <a href=https://docs.oracle.com/javase/7/docs/api/java/util/logging/Level.html>https://docs.oracle.com/javase/7/docs/api/java/util/logging/Level.html</a></td></tr><tr><td><code>--plain-logs</code></td><td>boolean</td><td><code>true</code></td><td>Use plain log lines</td></tr><tr><td><code>--structured-logs</code></td><td>boolean</td><td><code>false</code></td><td>Use structured logs</td></tr><tr><td><code>--tracing</code></td><td>boolean</td><td><code>true</code></td><td>Enable trace collection</td></tr><tr><td><code>--log-timestamp-format</code></td><td>string</td><td><code>HH:mm:ss.SSS</code></td><td>Allows the configure log timestamp format</td></tr></tbody></table><h3 id=network>Network</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--relax-checks</code></td><td>boolean</td><td><code>false</code></td><td>Relax checks on origin header and content type of incoming requests, in contravention of strict W3C spec compliance.</td></tr></tbody></table><h3 id=node>Node</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th><th></th></tr></thead><tbody><tr><td><code>--detect-drivers</code></td><td>boolean</td><td><code>true</code></td><td>Autodetect which drivers are available on the current system, and add them to the Node.</td><td></td></tr><tr><td><code>--driver-configuration</code></td><td>string[]</td><td><code>display-name="Firefox Nightly" max-sessions=2 webdriver-path="/usr/local/bin/geckodriver" stereotype="{\"browserName\": \"firefox\", \"browserVersion\": \"86\", \"moz:firefoxOptions\": {\"binary\":\"/Applications/Firefox Nightly.app/Contents/MacOS/firefox-bin\"}}"</code></td><td>List of configured drivers a Node supports. It is recommended to provide this type of configuration through a toml config file to improve readability</td><td></td></tr><tr><td><code>--driver-factory</code></td><td>string[]</td><td><code>org.openqa.selenium.example.LynxDriverFactory '{"browserName": "lynx"}'</code></td><td>Mapping of fully qualified class name to a browser configuration that this matches against.</td><td></td></tr><tr><td><code>--driver-implementation</code></td><td>string[]</td><td><code>"firefox"</code></td><td>Drivers that should be checked. If specified, will skip autoconfiguration.</td><td></td></tr><tr><td><code>--node-implementation</code></td><td>string</td><td><code>"org.openqa.selenium.grid.node.local.LocalNodeFactory"</code></td><td>Full classname of non-default Node implementation. This is used to manage a session&rsquo;s lifecycle.</td><td></td></tr><tr><td><code>--grid-url</code></td><td>string</td><td><code>https://grid.example.com</code></td><td>Public URL of the Grid as a whole (typically the address of the Hub or the Router)</td><td></td></tr><tr><td><code>--heartbeat-period</code></td><td>int</td><td><code>60</code></td><td>How often, in seconds, will the Node send heartbeat events to the Distributor to inform it that the Node is up.</td><td></td></tr><tr><td><code>--max-sessions</code></td><td>int</td><td><code>8</code></td><td>Maximum number of concurrent sessions. Default value is the number of available processors.</td><td></td></tr><tr><td><code>--override-max-sessions</code></td><td>boolean</td><td><code>false</code></td><td>The # of available processors is the recommended max sessions value (1 browser session per processor). Setting this flag to true allows the recommended max value to be overwritten. Session stability and reliability might suffer as the host could run out of resources.</td><td></td></tr><tr><td><code>--register-cycle</code></td><td>int</td><td><code>10</code></td><td>How often, in seconds, the Node will try to register itself for the first time to the Distributor.</td><td></td></tr><tr><td><code>--register-period</code></td><td>int</td><td><code>120</code></td><td>How long, in seconds, will the Node try to register to the Distributor for the first time. After this period is completed, the Node will not attempt to register again.</td><td></td></tr><tr><td><code>--session-timeout</code></td><td>int</td><td><code>300</code></td><td>Let X be the session-timeout in seconds. The Node will automatically kill a session that has not had any activity in the last X seconds. This will release the slot for other tests.</td><td></td></tr><tr><td><code>--vnc-env-var</code></td><td>string[]</td><td><code>SE_START_XVFB SE_START_VNC SE_START_NO_VNC</code></td><td>Environment variable to check in order to determine if a vnc stream is available or not.</td><td></td></tr><tr><td><code>--no-vnc-port</code></td><td>int</td><td><code>7900</code></td><td>If VNC is available, sets the port where the local noVNC stream can be obtained</td><td></td></tr><tr><td><code>--drain-after-session-count</code></td><td>int</td><td><code>1</code></td><td>Drain and shutdown the Node after X sessions have been executed. Useful for environments like Kubernetes. A value higher than zero enables this feature.</td><td></td></tr><tr><td><code>--hub</code></td><td>string</td><td><code>http://localhost:4444</code></td><td>The address of the Hub in a Hub-and-Node configuration. Can be a hostname or IP address (<code>hostname</code>), in which case the Hub will be assumed to be <code>http://hostname:4444</code>, the <code>--grid-url</code> will be the same <code>--publish-events</code> will be <code>tcp://hostname:4442</code> and <code>--subscribe-events</code> will be <code>tcp://hostname:4443</code>. If <code>hostname</code> contains a port number, that will be used for <code>--grid-url</code> but the URIs for the event bus will remain the same. Any of these default values may be overridden but setting the correct flags. If the hostname has a protocol (such as <code>https</code>) that will be used too.</td><td></td></tr><tr><td><code>--enable-cdp</code></td><td>boolean</td><td><code>true</code></td><td>Enable CDP proxying in Grid. A Grid admin can disable CDP if the network doesnot allow websockets. True by default.</td><td></td></tr><tr><td><code>--enable-managed-downloads</code></td><td>boolean</td><td><code>false</code></td><td>This causes the Node to auto manage files downloaded for a given session on the Node.</td><td></td></tr><tr><td><code>--selenium-manager</code></td><td>boolean</td><td><code>false</code></td><td>When drivers are not available on the current system, use Selenium Manager. False by default.</td><td></td></tr><tr><td><code>--connection-limit-per-session</code></td><td>int</td><td><code>10</code></td><td>Let X be the maximum number of websocket connections per session.This will ensure one session is not able to exhaust the connection limit of the host.</td><td></td></tr></tbody></table><h3 id=relay>Relay</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--service-url</code></td><td>string</td><td><code>http://localhost:4723</code></td><td>URL for connecting to the service that supports WebDriver commands like an Appium server or a cloud service.</td></tr><tr><td><code>--service-host</code></td><td>string</td><td><code>localhost</code></td><td>Host name where the service that supports WebDriver commands is running</td></tr><tr><td><code>--service-port</code></td><td>int</td><td><code>4723</code></td><td>Port where the service that supports WebDriver commands is running</td></tr><tr><td><code>--service-status-endpoint</code></td><td>string</td><td><code>/status</code></td><td>Optional, endpoint to query the WebDriver service status, an HTTP 200 response is expected</td></tr><tr><td><code>--service-protocol-version</code></td><td>string</td><td><code>HTTP/1.1</code></td><td>Optional, enforce a specific protocol version in HttpClient when communicating with the endpoint service status</td></tr><tr><td><code>--service-configuration</code></td><td>string[]</td><td><code>max-sessions=2 stereotype='{"browserName": "safari", "platformName": "iOS", "appium:platformVersion": "14.5"}}'</code></td><td>Configuration for the service where calls will be relayed to. It is recommended to provide this type of configuration through a toml config file to improve readability.</td></tr></tbody></table><h3 id=router>Router</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--password</code></td><td>string</td><td><code>myStrongPassword</code></td><td>Password clients must use to connect to the server. Both this and the username need to be set in order to be used.</td></tr><tr><td><code>--username</code></td><td>string</td><td><code>admin</code></td><td>User name clients must use to connect to the server. Both this and the password need to be set in order to be used.</td></tr><tr><td><code>--sub-path</code></td><td>string</td><td><code>my_company/selenium_grid</code></td><td>A sub-path that should be considered for all user facing routes on the Hub/Router/Standalone.</td></tr><tr><td><code>--disable-ui</code></td><td>boolean</td><td><code>true</code></td><td>Disable the Grid UI.</td></tr></tbody></table><h3 id=server>Server</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--allow-cors</code></td><td>boolean</td><td><code>true</code></td><td>Whether the Selenium server should allow web browser connections from any host</td></tr><tr><td><code>--host</code></td><td>string</td><td><code>localhost</code></td><td>Server IP or hostname: usually determined automatically.</td></tr><tr><td><code>--bind-host</code></td><td>boolean</td><td><code>true</code></td><td>Whether the server should bind to the host address/name, or only use it to" report its reachable url. Helpful in complex network topologies where the server cannot report itself with the current IP/hostname but rather an external IP or hostname (e.g. inside a Docker container)</td></tr><tr><td><code>--https-certificate</code></td><td>path</td><td><code>/path/to/cert.pem</code></td><td>Server certificate for https. Get more detailed information by running &ldquo;java -jar selenium-server.jar info security&rdquo;</td></tr><tr><td><code>--https-private-key</code></td><td>path</td><td><code>/path/to/key.pkcs8</code></td><td>Private key for https. Get more detailed information by running &ldquo;java -jar selenium-server.jar info security&rdquo;</td></tr><tr><td><code>--max-threads</code></td><td>int</td><td><code>24</code></td><td>Maximum number of listener threads. Default value is: (available processors) * 3.</td></tr><tr><td><code>--port</code></td><td>int</td><td><code>4444</code></td><td>Port to listen on. There is no default as this parameter is used by different components, for example, Router/Hub/Standalone will use 4444 and Node will use 5555.</td></tr></tbody></table><h3 id=sessionqueue>SessionQueue</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--sessionqueue</code></td><td>uri</td><td><code>http://localhost:1237</code></td><td>Address of the session queue server.</td></tr><tr><td><code>-sessionqueue-host</code></td><td>string</td><td><code>localhost</code></td><td>Host on which the session queue server is listening.</td></tr><tr><td><code>--sessionqueue-port</code></td><td>int</td><td><code>1234</code></td><td>Port on which the session queue server is listening.</td></tr><tr><td><code>--session-request-timeout</code></td><td>int</td><td><code>300</code></td><td>Timeout in seconds. A new incoming session request is added to the queue. Requests sitting in the queue for longer than the configured time will timeout.</td></tr><tr><td><code>--session-retry-interval</code></td><td>int</td><td><code>5</code></td><td>Retry interval in seconds. If all slots are busy, new session request will be retried after the given interval.</td></tr></tbody></table><h3 id=sessions>Sessions</h3><table><thead><tr><th>Opção</th><th>Tipo</th><th>Valor/Exemplo</th><th>Descrição</th></tr></thead><tbody><tr><td><code>--sessions</code></td><td>uri</td><td><code>http://localhost:1234</code></td><td>Address of the session map server.</td></tr><tr><td><code>--sessions-host</code></td><td>string</td><td><code>localhost</code></td><td>Host on which the session map server is listening.</td></tr><tr><td><code>--sessions-port</code></td><td>int</td><td><code>1234</code></td><td>Port on which the session map server is listening.</td></tr></tbody></table><h2 id=configuration-examples>Configuration examples</h2><p>All the options mentioned above can be used when starting the Grid components. They are a good
way of exploring the Grid options, and trying out values to find a suitable configuration.</p><div class="pageinfo pageinfo-primary"><p>We recommend the use of <a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/toml_options/>Toml files</a> to configure a Grid.
Configuration files improve readability, and you can also check them in source control.</p><p>When needed, you can combine a Toml file configuration with CLI arguments.</p></div><h3 id=command-line-flags>Command-line flags</h3><p>To pass config options as command-line flags, identify the valid options for the component
and follow the template below.</p><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar &lt;component&gt; --&lt;option&gt; value
</code></pre><h4 id=standalone-setting-max-sessions-and-main-port>Standalone, setting max sessions and main port</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar standalone --max-sessions 4 --port 4444
</code></pre><h4 id=hub-setting-a-new-session-request-timeout-a-main-port-and-disabling-tracing>Hub, setting a new session request timeout, a main port, and disabling tracing</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar hub --session-request-timeout 500 --port 3333 --tracing false
</code></pre><h4 id=node-with-4-max-sessions-with-debugfine-log-7777-as-port-and-only-with-firefox-and-edge>Node, with 4 max sessions, with debug(fine) log, 7777 as port, and only with Firefox and Edge</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --max-sessions 4 --log-level &#34;fine&#34; --port 7777 --driver-implementation &#34;firefox&#34; --driver-implementation &#34;edge&#34;
</code></pre><h4 id=distributor-setting-session-map-server-url-session-queue-server-url-and-disabling-bus>Distributor, setting Session Map server url, Session Queue server url, and disabling bus</h4><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar distributor --sessions http://localhost:5556 --sessionqueue http://localhost:5559 --bind-bus false
</code></pre><h4 id=setting-custom-capabilities-for-matching-specific-nodes>Setting custom capabilities for matching specific Nodes</h4><p><strong>Important:</strong> Custom capabilities need to be set in the configuration in all Nodes. They also
need to be included always in every session request.</p><h5 id=start-the-hub>Start the Hub</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar hub
</code></pre><h5 id=start-the-node-a-with-custom-cap-set-to-true>Start the Node A with custom cap set to <code>true</code></h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --detect-drivers false --driver-configuration display-name=&#34;Chrome (custom capability true)&#34; max-sessions=1 stereotype=&#39;{&#34;browserName&#34;:&#34;chrome&#34;,&#34;gsg:customcap&#34;:true}&#39; --port 6161
</code></pre><h5 id=start-the-node-b-with-custom-cap-set-to-false>Start the Node B with custom cap set to <code>false</code></h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --detect-drivers false --driver-configuration display-name=&#34;Chrome (custom capability true)&#34; max-sessions=1 stereotype=&#39;{&#34;browserName&#34;:&#34;chrome&#34;,&#34;gsg:customcap&#34;:false}&#39; --port 6262
</code></pre><h5 id=matching-node-a>Matching Node A</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>ChromeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>options</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ChromeOptions</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;gsg:customcap&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>WebDriver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>driver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RemoteWebDriver</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URL</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://localhost:4444&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>options</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;https://selenium.dev&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Set the custom capability to <code>false</code> in order to match the Node B.</p><h4 id=enabling-managed-downloads-by-the-node>Enabling Managed downloads by the Node</h4><p>At times a test may need to access files that were downloaded by it on the Node.
To retrieve such files, following can be done.</p><h5 id=start-the-hub-1>Start the Hub</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar hub
</code></pre><h5 id=start-the-node-with-manage-downloads-enabled>Start the Node with manage downloads enabled</h5><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar node --enable-managed-downloads true
</code></pre><h5 id=set-the-capability-at-the-test-level>Set the capability at the test level</h5><p>Tests that want to use this feature should set the capability <code>"se:downloadsEnabled"</code>to <code>true</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:downloadsEnabled&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h5 id=how-does-this-work>How does this work</h5><ul><li>The Grid infrastructure will try to match a session request with <code>"se:downloadsEnabled"</code> against ONLY those nodes which were started with <code>--enable-managed-downloads true</code></li><li>If a session is matched, then the Node automatically sets the required capabilities to let the browser know, as to where should a file be downloaded.</li><li>The Node now allows a user to:<ul><li>List all the files that were downloaded for a specific session and</li><li>Retrieve a specific file from the list of files.</li></ul></li><li>The directory into which files were downloaded for a specific session gets automatically cleaned up when the session ends (or) timesout due to inactivity.</li></ul><p><strong>Note: Currently this capability is ONLY supported on:</strong></p><ul><li><code>Edge</code></li><li><code>Firefox</code> and</li><li><code>Chrome</code> browser</li></ul><h5 id=listing-files-that-can-be-downloaded-for-current-session>Listing files that can be downloaded for current session:</h5><ul><li>The endpoint to <code>GET</code> from is <code>/session/&lt;sessionId>/se/files</code>.</li><li>The session needs to be active in order for the command to work.</li><li>The raw response looks like below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;names&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In the response the list of file names appear under the key <code>names</code>.</p><h5 id=dowloading-a-file>Dowloading a file:</h5><ul><li>The endpoint to <code>POST</code> from is <code>/session/&lt;sessionId>/se/files</code> with a payload of the form <code>{"name": "fileNameGoesHere}</code></li><li>The session needs to be active in order for the command to work.</li><li>The raw response looks like below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;filename&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;contents&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Base64EncodedStringContentsOfDownloadedFileAsZipGoesHere&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>The response blob contains two keys,<ul><li><code>filename</code> - The file name that was downloaded.</li><li><code>contents</code> - Base64 encoded zipped contents of the file.</li></ul></li><li>The file contents are Base64 encoded and they need to be unzipped.</li></ul><h5 id=list-files-that-can-be-downloaded>List files that can be downloaded</h5><p>The below mentioned <code>curl</code> example can be used to list all the files that were downloaded by the current session in the Node, and which can be retrieved locally.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X GET <span style=color:#4e9a06>&#34;http://localhost:4444/session/90c0149a-2e75-424d-857a-e78734943d4c/se/files&#34;</span>
</span></span></code></pre></div><p>A sample response would look like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;names&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=retrieve-a-downloaded-file>Retrieve a downloaded file</h5><p>Assuming the downloaded file is named <code>Red-blue-green-channel.jpg</code>, and using <code>curl</code>, the
file could be downloaded with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -H <span style=color:#4e9a06>&#34;Accept: application/json&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>-H <span style=color:#4e9a06>&#34;Content-Type: application/json; charset=utf-8&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>-X POST -d <span style=color:#4e9a06>&#39;{&#34;name&#34;:&#34;Red-blue-green-channel.jpg&#34;}&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span><span style=color:#4e9a06>&#34;http://localhost:4444/session/18033434-fa4f-4d11-a7df-9e6d75920e19/se/files&#34;</span>
</span></span></code></pre></div><p>A sample response would look like below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;value&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;filename&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Red-blue-green-channel.jpg&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;contents&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;UEsDBBQACAgIAJpagVYAAAAAAAAAAAAAAAAaAAAAUmVkLWJsAAAAAAAAAAAAUmVkLWJsdWUtZ3JlZW4tY2hhbm5lbC5qcGdQSwUGAAAAAAEAAQBIAAAAcNkAAAAA&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=complete-sample-code-in-java>Complete sample code in Java</h5><p>Below is an example in Java that does the following:</p><ul><li>Sets the capability to indicate that the test requires automatic managing of downloaded files.</li><li>Triggers a file download via a browser.</li><li>Lists the files that are available for retrieval from the remote node (These are essentially files that were downloaded in the current session)</li><li>Picks one file and downloads the file from the remote node to the local machine.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>com.google.common.collect.ImmutableMap</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.By</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.io.Zip</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.json.Json</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.RemoteWebDriver</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpClient</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpRequest</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpResponse</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.io.File</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.net.URL</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.nio.file.Files</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.util.List</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.util.Map</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.util.Optional</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.util.concurrent.TimeUnit</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.Contents.asJson</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.Contents.string</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpMethod.GET</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpMethod.POST</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DownloadsSample</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Assuming the Grid is running locally.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>URL</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gridUrl</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URL</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://localhost:4444&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>ChromeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>options</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ChromeOptions</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;se:downloadsEnabled&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>RemoteWebDriver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>driver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RemoteWebDriver</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gridUrl</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>options</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>demoFileDownloads</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gridUrl</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>demoFileDownloads</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>RemoteWebDriver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URL</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gridUrl</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;https://www.selenium.dev/selenium/web/downloads/download.html&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// Download the two available files on the page</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>findElement</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>By</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>id</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;file-1&#34;</span><span style=color:#000;font-weight:700>)).</span><span style=color:#c4a000>click</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>findElement</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>By</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>id</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;file-2&#34;</span><span style=color:#000;font-weight:700>)).</span><span style=color:#c4a000>click</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// The download happens in a remote Node, which makes it difficult to know when the file</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// has been completely downloaded. For demonstration purposes, this example uses a</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 10-second sleep which should be enough time for a file to be downloaded.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// We strongly recommend to avoid hardcoded sleeps, and ideally, to modify your</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// application under test, so it offers a way to know when the file has been completely</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// downloaded.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>TimeUnit</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>SECONDS</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>10</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//This is the endpoint which will provide us with list of files to download and also to</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//let us download a specific file.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>downloadsEndpoint</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>format</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/session/%s/se/files&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getSessionId</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fileToDownload</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>HttpClient</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>client</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>Factory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>createDefault</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>createClient</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gridUrl</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// To list all files that are were downloaded on the remote node for the current session</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// we trigger GET request.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>HttpRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>request</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpRequest</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>downloadsEndpoint</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>HttpResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jsonResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Json</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toType</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>string</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Json</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>MAP_TYPE</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jsonResponse</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;value&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>names</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;names&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// Let&#39;s say there were &#34;n&#34; files downloaded for the current session, we would like</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// to retrieve ONLY the first file.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>fileToDownload</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>names</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// Now, let&#39;s download the file</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>HttpClient</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>client</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpClient</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>Factory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>createDefault</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>createClient</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gridUrl</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// To retrieve a specific file from one or more files that were downloaded by the current session</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// on a remote node, we use a POST request.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>HttpRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>request</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpRequest</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>POST</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>downloadsEndpoint</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setContent</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>asJson</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ImmutableMap</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>of</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fileToDownload</span><span style=color:#000;font-weight:700>)));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>HttpResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>response</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jsonResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Json</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toType</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>string</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Json</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>MAP_TYPE</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jsonResponse</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;value&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// The returned map would contain 2 keys,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// filename - This represents the name of the file (same as what was provided by the test)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// contents - Base64 encoded String which contains the zipped file.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>zippedContents</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;contents&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// The file contents would always be a zip file and has to be unzipped.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>File</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>downloadDir</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Zip</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>unzipToTempDir</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>zippedContents</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;download&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#8f5902;font-style:italic>// Read the file contents</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>File</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>downloadedFile</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Optional</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>ofNullable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>downloadDir</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>listFiles</span><span style=color:#000;font-weight:700>()).</span><span style=color:#c4a000>orElse</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>File</span><span style=color:#ce5c00;font-weight:700>[]</span><span style=color:#000;font-weight:700>{})</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>0</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fileContent</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>join</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Files</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>readAllLines</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>downloadedFile</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toPath</span><span style=color:#000;font-weight:700>()));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;The file which was &#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;downloaded in the node is now available in the directory: &#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>downloadDir</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getAbsolutePath</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34; and has the contents: &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fileContent</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b112688e72f40f34b417d747cee9d825>4.3 - Toml Options</h1><div class=lead>Grid configuration examples using Toml files.</div><div class="pageinfo pageinfo-warning"><p class=lead><i class="fas fa-language d-4"></i>
Page being translated from
English to Portuguese. Do you speak Portuguese? Help us to translate
it by sending us pull requests!</p></div><p>All the options shown in <a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/cli_options/>CLI options</a> can be configured through
a <a href=https://github.com/toml-lang/toml>TOML</a> file. This page shows configuration examples for the
different Grid components.</p><div class="pageinfo pageinfo-primary"><p>Note that this documentation could be outdated if an option was modified or added
but has not been documented yet. In case you bump into this situation, please check
the <a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/help/>&ldquo;Config help&rdquo;</a> section and feel free to send us a
pull request updating this page.</p></div><h2 id=overview>Overview</h2><p>Selenium Grid uses <a href=https://github.com/toml-lang/toml>TOML</a> format for config files.
The config file consists of sections and each section has options and its respective value(s).</p><p>Refer to the <a href=https://toml.io/en/>TOML documentation</a> for detailed usage guidance. In case of
parsing errors, validate the config using <a href=https://www.toml-lint.com/>TOML linter</a>.</p><p>The general configuration structure has the following pattern:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>section1</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>option1</span><span style=color:#000;font-weight:700>=</span><span style=color:#4e9a06>&#34;value&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>section2</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>option2</span><span style=color:#000;font-weight:700>=[</span><span style=color:#4e9a06>&#34;value1&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;value2&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>option3</span><span style=color:#000;font-weight:700>=</span><span style=color:#204a87;font-weight:700>true</span>
</span></span></code></pre></div><p>Below are some examples of Grid components configured with a Toml file, the component can be
started in the following way:</p><pre tabindex=0><code>java -jar selenium-server-&lt;version&gt;.jar &lt;component&gt; --config /path/to/file/&lt;file-name&gt;.toml
</code></pre><h3 id=standalone>Standalone</h3><p>A Standalone server, running on port 4449, and a new session request timeout of 500 seconds.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>server</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>port</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4449</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessionqueue</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>session-request-timeout</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>500</span>
</span></span></code></pre></div><h3 id=specific-browsers-and-a-limit-of-max-sessions>Specific browsers and a limit of max sessions</h3><p>A Standalone server or a Node which only has Firefox and Chrome enabled by default.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;chrome&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;firefox&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span>
</span></span></code></pre></div><h3 id=configuring-and-customising-drivers>Configuring and customising drivers</h3><p>Standalone or Node server with customised drivers, which allows things like having Firefox Beta
or Nightly, and having different browser versions.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>100</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Firefox Nightly&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;firefox\&#34;, \&#34;browserVersion\&#34;: \&#34;93\&#34;, \&#34;platformName\&#34;: \&#34;MAC\&#34;, \&#34;moz:firefoxOptions\&#34;: {\&#34;binary\&#34;: \&#34;/Applications/Firefox Nightly.app/Contents/MacOS/firefox-bin\&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Chrome Beta&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;browserVersion\&#34;: \&#34;94\&#34;, \&#34;platformName\&#34;: \&#34;MAC\&#34;, \&#34;goog:chromeOptions\&#34;: {\&#34;binary\&#34;: \&#34;/Applications/Google Chrome Beta.app/Contents/MacOS/Google Chrome Beta\&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Chrome Dev&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;browserVersion\&#34;: \&#34;95\&#34;, \&#34;platformName\&#34;: \&#34;MAC\&#34;, \&#34;goog:chromeOptions\&#34;: {\&#34;binary\&#34;: \&#34;/Applications/Google Chrome Dev.app/Contents/MacOS/Google Chrome Dev\&#34;}}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>webdriver-executable</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;/path/to/chromedriver/95/chromedriver&#39;</span>
</span></span></code></pre></div><h3 id=standalone-or-node-with-docker>Standalone or Node with Docker</h3><p>A Standalone or Node server that is able to run each new session in a Docker container. Disabling
drivers detection, having maximum 2 concurrent sessions. Stereotypes configured need to be mapped
to a Docker image, and the Docker daemon needs to be exposed via http/tcp. In addition, it is
possible to define which device files, accessible on the host, will be available in containers
through the <code>devices</code> property. Refer to the <a href=https://docs.docker.com/engine/reference/commandline/run/#add-host-device-to-container---device>docker</a> documentation
for more information about how docker device mapping works.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>docker</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>configs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;selenium/standalone-chrome:93.0&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;browserVersion\&#34;: \&#34;91\&#34;}&#34;</span><span style=color:#000;font-weight:700>,</span> 
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;selenium/standalone-firefox:92.0&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;firefox\&#34;, \&#34;browserVersion\&#34;: \&#34;92\&#34;}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#Optionally define all device files that should be mapped to docker containers</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#devices = [</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#    &#34;/dev/kvm:/dev/kvm&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#]</span>
</span></span><span style=display:flex><span><span style=color:#000>url</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;http://localhost:2375&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>video-image</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;selenium/video:latest&#34;</span>
</span></span></code></pre></div><h3 id=relaying-commands-to-a-service-endpoint-that-supports-webdriver>Relaying commands to a service endpoint that supports WebDriver</h3><p>It is useful to connect an external service that supports WebDriver to Selenium Grid.
An example of such service could be a cloud provider or an Appium server. In this way,
Grid can enable more coverage to platforms and versions not present locally.</p><p>The following is an en example of connecting an Appium server to Grid.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>relay</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Default Appium/Cloud server endpoint</span>
</span></span><span style=display:flex><span><span style=color:#000>url</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;http://localhost:4723/wd/hub&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>status-endpoint</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/status&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Optional, enforce a specific protocol version in HttpClient when communicating with the endpoint service status (e.g. HTTP/1.1, HTTP/2)</span>
</span></span><span style=display:flex><span><span style=color:#000>protocol-version</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;HTTP/1.1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Stereotypes supported by the service. The initial number is &#34;max-sessions&#34;, and will allocate </span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># that many test slots to that particular configuration</span>
</span></span><span style=display:flex><span><span style=color:#000>configs</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;{\&#34;browserName\&#34;: \&#34;chrome\&#34;, \&#34;platformName\&#34;: \&#34;android\&#34;, \&#34;appium:platformVersion\&#34;: \&#34;11\&#34;}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h3 id=basic-auth-enabled>Basic auth enabled</h3><p>It is possible to protect a Grid with basic auth by configuring the Router/Hub/Standalone with
a username and password. This user/password combination will be needed when loading the Grid UI
or starting a new session.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>router</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>username</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;admin&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>password</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;myStrongPassword&#34;</span>
</span></span></code></pre></div><p>Here is a Java example showing how to start a session using the configured user and password.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>ClientConfig</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clientConfig</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClientConfig</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>defaultConfig</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>baseUrl</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URL</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://localhost:4444&#34;</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>authenticateAs</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>UsernameAndPassword</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;admin&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;myStrongPassword&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>HttpCommandExecutor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpCommandExecutor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>clientConfig</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>RemoteWebDriver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>driver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RemoteWebDriver</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executor</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ChromeOptions</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In other languages, you can use the URL http://admin:myStrongPassword@localhost:4444</p><h3 id=setting-custom-capabilities-for-matching-specific-nodes>Setting custom capabilities for matching specific Nodes</h3><p><strong>Important:</strong> Custom capabilities need to be set in the configuration in all Nodes. They also
need to be included always in every session request.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>detect-drivers</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>[[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>driver-configuration</span><span style=color:#000;font-weight:700>]]</span>
</span></span><span style=display:flex><span><span style=color:#000>display-name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;firefox&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>stereotype</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#39;{&#34;browserName&#34;: &#34;firefox&#34;, &#34;platformName&#34;: &#34;macOS&#34;, &#34;browserVersion&#34;:&#34;96&#34;, &#34;networkname:applicationName&#34;:&#34;node_1&#34;, &#34;nodename:applicationName&#34;:&#34;app_1&#34; }&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>max-sessions</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span>
</span></span></code></pre></div><p>Here is a Java example showing how to match that Node</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>FirefoxOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>options</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FirefoxOptions</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;networkname:applicationName&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;node_1&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setCapability</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;nodename:applicationName&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;app_1&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setBrowserVersion</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;96&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>options</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setPlatformName</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;macOS&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>WebDriver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>driver</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RemoteWebDriver</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URL</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;http://localhost:4444&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>options</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;https://selenium.dev&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>driver</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>quit</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=enabling-managed-downloads-by-the-node>Enabling Managed downloads by the Node.</h3><p>The Node can be instructed to manage downloads automatically. This will cause the Node to save all files that were downloaded for a particular session into a temp directory, which can later be retrieved from the node.
To turn this capability on, use the below configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>node</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>enable-managed-downloads</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span></code></pre></div><p>Refer to the <a href=https://www.selenium.dev/pt-br/documentation/grid/configuration/cli_options/#enabling-managed-downloads-by-the-node>CLI section</a> for a complete example.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-cf345e864afd2cccb282c4c5d3e03055>5 - Arquitectura da Grid</h1><p>A Grid está desenhada como um conjunto de componentes, em que cada tem
o seu papel crucial em manter a Grid. Isto pode parecer um pouco complicado,
mas esperamos que este documento ajude a esclarecer alguma confusão.</p><h2 id=os-componentes-chave>Os componentes chave</h2><p>Os componentes principais da Grid são:</p><dl><dt>Event Bus<dd>Usado para enviar mensagens que podem ser recebidas de forma assíncrona
entre os outros componentes.<dt>New Session Queue<dd>Mantém uma lista de pedidos de sessão que serão assignadas a um Node
pelo Distributor.<dt>Distributor<dd>Responsável por manter um modelo das localizações da Grid (slots) onde uma
sessão pode ser lançada e também por aceitar novos
<a href=https://w3c.github.io/webdriver/#new-session>pedidos de sessão</a>
e assignar a um slot livre.<dt>Node<dd>Executa uma <a href=https://w3c.github.io/webdriver/#dfn-sessions>sessão WebDriver</a>. Cada sessão é assignada a um slot e cada Node tem
um ou mais slots.<dt>Session Map<dd>Mantém um mapeamento entre um <a href=https://w3c.github.io/webdriver/#dfn-session-id>ID de sessão</a>
e o endereço do Node onde a sessão está a ser executada.<dt>Router<dd>Este é o ponto de entrada da Grid. É também a única parte da Grid
que <i>poderá</i> estar exposta à Internet (embora nós não recomendemos).
Este componente reencaminha novos pedidos para New Session Queue ou
para o Node onde a sessão esteja a ser executada</dl><p>Ao falar da Grid, há alguns conceitos úteis a ter em mente:</p><ul><li>Um <strong>slot</strong> é o sítio onde uma sessão pode ser executada</li><li>Cada slot tem um <strong>stereotype</strong>. Isto é um conjunto mínimo de capacidades
que um pedido de <a href=https://w3c.github.io/webdriver/#new-session>nova sessão</a> terá que corresponder antes que o
Distributor envie esse pedido ao Node que tenha esse slot</li><li>O <strong>Grid Model</strong> é como o Distributor mantém o estado actual da Grid.
Como o nome sugere, este modelo pode perder o sincronismo com a realidade.
Este mecanismo é preferível do que estar a questionar cada Node, e
desta forma, o Distributor rapidamente consegue alocar uma nova sessão a um slot.</li></ul><h2 id=chamadas-síncronas-e-assíncronas>Chamadas Síncronas e Assíncronas</h2><p>Existem duas formas de comunicação dentro da Grid:</p><ol><li>Chamadas Síncronas &ldquo;REST-ish&rdquo; que usam JSON sobre pedidos HTTP.</li><li>Eventos Assíncronos enviados para o Event Bus.</li></ol><p>Como é que escolhemos que tipo de mecanismo de comunicação a usar?
Afinal, podiamos ter escolhido usar apenas comunicação baseada em eventos
e tudo iria funcionar sem problemas.</p><p>No entanto a resposta correcta é, se a acção em curso é síncrona, por exemplo
a maioria das chamadas WebDriver, ou se perder uma resposta é problemático,
a Grid usa chamadas síncronas. Se quisermos propagar informação que pode ter
várias partes interessadas, ou se perder a mensagem não for crítico,
a Grid usará o event bus.</p><p>Um facto interessante a notar é que as chamadas assíncronas estão menos
&ldquo;presas&rdquo; aos processos que as executam do que todas as chamadas síncronas.</p><h2 id=sequência-de-início-e-dependencias-entre-componentes>Sequência de início e dependencias entre componentes</h2><p>Embora a Grid seja desenhada para permitir que os componentes possam iniciar
em qualquer ordem, conceptualmente é esperado que a ordem de início seja:</p><ol><li>O Event Bus e o Session Map iniciam primeiro. Estes componentes não tem qualquer
dependencia, nem mesmo entre eles e como tal, podem iniciar em paralelo.</li><li>A Session Queue inicia de seguida</li><li>O Distributor inicia. Irá periodicamente procurar novos pedidos de sessão
na Session Queue, embora possa também receber um evento de um pedidos de sessão.</li><li>O Router pode ser agora iniciado. Novos pedidos de sessão são direccionados para
a Session Queue, o Distributor tentará encontrar um slot onde a sessão possa ser
executada.</li><li>O Node pode ser iniciado, veja mais abaixo os detalhes de como o Node se
regista na Grid. Uma vez que o registo esteja concluído, a Grid estará
pronta a receber pedidos.</li></ol><p>Nesta tabela pode ser visualizada a dependencia ente os vários componentes.
Um &ldquo;✅&rdquo; indica que a dependência é síncrona.</p><table><thead><tr><th></th><th>Event Bus</th><th>Distributor</th><th>Node</th><th>Router</th><th>Session Map</th><th>Session Queue</th></tr></thead><tbody><tr><td>Event Bus</td><td>X</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Distributor</td><td>✅</td><td>X</td><td>✅</td><td></td><td></td><td>✅</td></tr><tr><td>Node</td><td>✅</td><td></td><td>X</td><td></td><td></td><td></td></tr><tr><td>Router</td><td></td><td></td><td>✅</td><td>X</td><td>✅</td><td></td></tr><tr><td>Session Map</td><td></td><td></td><td></td><td></td><td>X</td><td></td></tr><tr><td>Session Queue</td><td>✅</td><td></td><td></td><td></td><td></td><td>X</td></tr></tbody></table><h2 id=registo-de-node>Registo de Node</h2><p>O processo de registar um Node na Grid é um processo &ldquo;leve&rdquo;.</p><ol><li>Quando um Node inicia, vai publicar um evento &ldquo;heart beat&rdquo; numa
base regular. Este evento contém o estado do Node.</li><li>O Distributor escuta os eventos &ldquo;heart beat&rdquo; e quando obtém um,
tenta um <code>GET</code> ao endpoint <code>/status</code> do Node. A Grid é
preparada com base nesta informação.</li></ol><p>O Distributor irá usar regularmente o endpoint <code>/status</code> para continuar
a obter o estado do Node. Por seu lado, o Node continua a publicar um
evento &ldquo;heart beat&rdquo; mesmo depois do registo ter sido concluído com
sucesso.
Isto é feito para que mesmo que um Distributor não tenha um estado
da Grid possa reiniciar e assim obter novamente uma visão do estado
da Grid e assim ficar actualizado.</p><h3 id=objecto-node-status>Objecto Node Status</h3><p>O Node Status é um blob JSON com os seguintes campos:</p><table><thead><tr><th>Nome</th><th>Tipo</th><th>Descrição</th></tr></thead><tbody><tr><td>availability</td><td>string</td><td>Uma string com <code>up</code>, <code>draining</code>, ou <code>down</code>. A mais importante é <code>draining</code>, que indica que não devem ser enviados novos pedidos de sessão para o Node e assim que a última sessão termine, o Node irá reiniciar ou concluir.</td></tr><tr><td>externalUrl</td><td>string</td><td>Uma URI que os outros componentes da Grid se devem ligar.</td></tr><tr><td>lastSessionCreated</td><td>integer</td><td>Um timestamp da última sessão que foi criada neste Node. O Distributor irá tentar enviar novos pedidos de sessão para o Node que esteja parado há mais tempo.</td></tr><tr><td>maxSessionCount</td><td>integer</td><td>Embora seja possível inferir o número máximo de sessões a partir da lista de slots disponíveis, este número é usado para determinar qual é o máximo de sessões que este Node pode executar em simultâneo antes que se considere que está &ldquo;cheio&rdquo;.</td></tr><tr><td>nodeId</td><td>string</td><td>Um identificador UUID para esta instância do Node.</td></tr><tr><td>osInfo</td><td>object</td><td>Um objecto contendo os campos <code>arch</code>, <code>name</code>, e <code>version</code>. Isto é usado pela Grid UI e pelas queries GraphQL.</td></tr><tr><td>slots</td><td>array</td><td>Um array de objectos Slot (descritos na secção seguinte)</td></tr><tr><td>version</td><td>string</td><td>A versão do Node (para Selenium, será igual à versão do Selenium)</td></tr></tbody></table><p>É recomendado que todos os campos tenham valores.</p><h3 id=o-objecto-slot>O Objecto Slot</h3><p>O objecto Slot representa um slot dentro de um Node. Um &ldquo;slot&rdquo; é onde uma sessão consegue ser executada. É possível que um Node tenha mais do que um Slot capaz de executar ao mesmo tempo.
Por exemplo, um Node pode ser capaz de executar até 10 sessões em simultâneo, mas podem ser uma qualquer combinação de Chrome, Firefox ou Edge e neste caso, o Node irá indicar 10 como o
número máximo de sessões, indicando que podem ser 10 Chrome, 10 Firefox e 10 Edge.</p><table><thead><tr><th>Nome</th><th>Tipo</th><th>Descrição</th></tr></thead><tbody><tr><td>id</td><td>string</td><td>Um identificador UUID para este slot</td></tr><tr><td>lastStarted</td><td>string</td><td>timestamp no formato ISO-8601 contendo a data em que a última sessão iniciou</td></tr><tr><td>stereotype</td><td>object</td><td>Conjunto mínimo de <a href=https://w3c.github.io/webdriver/#dfn-merging-capabilities>capacidades</a> que fazem match com este slot. O exemplo mínimo será por exemplo <code>{"browserName": "firefox"}</code></td></tr><tr><td>session</td><td>object</td><td>O objecto Session (descrito na secção seguinte)</td></tr></tbody></table><h3 id=o-objecto-session>O Objecto Session</h3><p>Representa uma sessão em execução dentro de um Slot</p><table><thead><tr><th>Nome</th><th>Tipo</th><th>Descrição</th></tr></thead><tbody><tr><td>capabilities</td><td>object</td><td>A lista de capacidades fornecidas pela sessão. Irá coincidir com o valor obtido pelo comando <a href=https://w3c.github.io/webdriver/#new-session>nova sessão</a></td></tr><tr><td>startTime</td><td>string</td><td>timestamp no formato ISO-8601 contendo a data em que a última sessão iniciou</td></tr><tr><td>stereotype</td><td>object</td><td>Conjunto mínimo de <a href=https://w3c.github.io/webdriver/#dfn-merging-capabilities>capacidades</a> que fazem match com este slot. O exemplo mínimo será por exemplo <code>{"browserName": "firefox"}</code></td></tr><tr><td>uri</td><td>string</td><td>A URI usada pelo Node para comunicar com a sessão</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-0a55bd7bbf52302fce2db52de9355fdd>6 - Características avançadas</h1><div class=lead>Para obter todos os detalhes dos recursos avançados, entenda como funciona e como configurar crie o seu próprio, navegue pelas seções a seguir.</div></div><div class=td-content><h1 id=pg-0559dcb12b1e3ebb50211585a83e0be8>6.1 - Observabilidade</h1><h2 id=índice>Índice</h2><ul><li><a href=/pt-br/documentation/grid/advanced_features/observability/#selenium-grid>Selenium Grid</a></li><li><a href=/pt-br/documentation/grid/advanced_features/observability/#observabilidade>Observabilidade</a><ul><li><a href=/pt-br/documentation/grid/advanced_features/observability/#rastreamento-distribuído>Rastreamento distribuído</a></li><li><a href=/pt-br/documentation/grid/advanced_features/observability/#Registro-de-eventos>Registro de eventos</a></li></ul></li><li><a href=/pt-br/documentation/grid/advanced_features/observability/#observabilidade-da-grade>Observabilidade da Grade</a><ul><li><a href=/pt-br/documentation/grid/advanced_features/observability/#visualizando-traços>Visualizando Traços</a></li><li><a href=/pt-br/documentation/grid/advanced_features/observability/#Aproveitando-logs-de-eventos>Aproveitando logs de eventos</a></li></ul></li><li><a href=/pt-br/documentation/grid/advanced_features/observability/#referências>Referências</a></li></ul><h2 id=selenium-grid>Selenium Grid</h2><p>O Grid auxilia na escalabilidade e distribuição de testes, executando testes em várias combinações de navegadores e sistemas operacionais.</p><h2 id=observabilidade>Observabilidade</h2><p>A observabilidade tem três pilares: rastreamentos, métricas e registros. Como o Selenium Grid 4 foi projetado para ser totalmente distribuído, a observabilidade tornará mais fácil entender e depurar os detalhes internos.</p><h2 id=rastreamento-distribuído>Rastreamento Distribuído</h2><p>Uma única solicitação ou transação abrange vários serviços e componentes. O rastreamento acompanha o ciclo de vida da solicitação à medida que cada serviço a executa. Isso é útil para depurar cenários de erro.
Alguns termos-chave usados no contexto de rastreamento são:</p><p><strong>Rastreamento</strong>
O rastreamento permite rastrear uma solicitação por meio de vários serviços, desde sua origem até seu destino final. A jornada dessa solicitação ajuda na depuração, no monitoramento do fluxo de ponta a ponta e na identificação de falhas. Um rastreamento representa o fluxo da solicitação de ponta a ponta. Cada rastreamento possui um identificador único.</p><p><strong>Segmento</strong>
Cada rastreamento é composto por operações cronometradas chamadas segmentos. Um segmento possui um horário de início e término e representa operações realizadas por um serviço. A granularidade do segmento depende de como ele é instrumentado. Cada segmento possui um identificador único. Todos os segmentos dentro de um rastreamento têm o mesmo ID de rastreamento.</p><p><strong>Atributos de Segmento</strong>
Atributos de segmento são pares de chave e valor que fornecem informações adicionais sobre cada segmento.</p><p><strong>Eventos</strong>
Eventos são registros com carimbo de data/hora dentro de um segmento. Eles fornecem contexto adicional para os segmentos existentes. Os eventos também contêm pares de chave e valor como atributos de evento.</p><h2 id=registro-de-eventos>Registro de Eventos</h2><p>O registro é essencial para depurar um aplicativo. O registro é frequentemente feito em um formato legível por humanos. Mas, para que as máquinas possam pesquisar e analisar os registros, é necessário ter um formato bem definido. O registro estruturado é uma prática comum de registrar logs de forma consistente em um formato fixo. Ele normalmente contém campos como:</p><ul><li>Carimbo de data/horas</li><li>Nível de registro</li><li>Classe de registro</li><li>Mensagem de registro (isso é detalhado em campos relevantes à operação em que o registro foi feito)</li></ul><p>Registros e eventos estão intimamente relacionados. Os eventos encapsulam todas as informações possíveis para realizar uma única unidade de trabalho. Os registros são essencialmente subconjuntos de um evento. No cerne, ambos auxiliam na depuração.</p><p>Consulte os recursos a seguir para entender em detalhes:</p><ol><li><a href=https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/>https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/</a></li><li><a href=https://charity.wtf/2019/02/05/logs-vs-structured-events/>https://charity.wtf/2019/02/05/logs-vs-structured-events/</a></li></ol><h2 id=observabilidade-do-grid>Observabilidade do Grid</h2><p>O servidor Selenium é instrumentado com rastreamento usando o OpenTelemetry. Cada solicitação ao servidor é rastreada do início ao fim. Cada rastreamento consiste em uma série de segmentos à medida que uma solicitação é executada no servidor. A maioria dos segmentos no servidor Selenium consiste em dois eventos:</p><ol><li>Evento normal - registra todas as informações sobre uma unidade de trabalho e marca a conclusão bem-sucedida do trabalho.</li><li>Evento de erro - registra todas as informações até que ocorra o erro e, em seguida, registra as informações do erro. Marca um evento de exceção.</li></ol><p>Executando servidor Selenium</p><ol><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#standalone-mode>Standalone</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#hub-and-node>Hub and Node</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#fully-distributed>Fully Distributed</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#using-docker>Docker</a></li></ol><h2 id=visualizando-rastreamentos>Visualizando Rastreamentos</h2><p>Todos os segmentos, eventos e seus respectivos atributos fazem parte de um rastreamento. O rastreamento funciona enquanto o servidor é executado em todos os modos mencionados acima.</p><p>Por padrão, o rastreamento está habilitado no servidor Selenium. O servidor Selenium exporta os rastreamentos por meio de dois exportadores:</p><ol><li>Console - Registra todos os rastreamentos e os segmentos incluídos com nível FINE. Por padrão, o servidor Selenium imprime registros no nível INFO e acima.</li></ol><p>A opção <strong>log-level</strong> pode ser usada para definir um nível de registro de sua escolha ao executar o arquivo JAR do Selenium Grid jar/s.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-4.0.0-&lt;selenium-version&gt;.jar standalone --log-level FINE
</span></span></code></pre></div><ol start=2><li>Jaeger UI - OpenTelemetry fornece as APIs e SDKs para instrumentar rastreamentos no código. Enquanto o Jaeger é um sistema de rastreamento de backend que auxilia na coleta de dados de telemetria de rastreamento e oferece recursos de consulta, filtragem e visualização dos dados.</li></ol><p>Instruções detalhadas sobre como visualizar rastreamentos usando a interface do Jaeger podem ser obtidas executando o seguinte comando:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-4.0.0-&lt;selenium-version&gt;.jar info tracing
</span></span></code></pre></div><p><a href=https://github.com/manoj9788/tracing-selenium-grid>Um exemplo muito bom e scripts para executar o servidor e enviar rastreamentos para o Jaeger</a></p><h2 id=explorando-logs-de-eventos>Explorando logs de eventos</h2><p>O rastreamento deve estar habilitado para o registro de eventos, mesmo que alguém não deseje exportar rastreamentos para visualizá-los.</p><p><strong>Por padrão, o rastreamento está habilitado. Não é necessário passar parâmetros adicionais para ver os logs no console.</strong></p><p>Todos os eventos dentro de um segmento são registrados no nível FINE. Eventos de erro são registrados no nível WARN..</p><table><thead><tr><th>Campo</th><th>Valor do Campo</th><th>Descrição</th></tr></thead><tbody><tr><td>Hora do Evento</td><td>eventId</td><td>Carimbo de data/hora do registro do evento em nanossegundos desde a época.</td></tr><tr><td>ID de Rastreamento</td><td>tracedId</td><td>Cada rastreamento é identificado exclusivamente por um ID de rastreamento.</td></tr><tr><td>ID de Segmento</td><td>spanId</td><td>Cada segmento dentro de um rastreamento é identificado exclusivamente por um ID de segmento.</td></tr><tr><td>Tipo de Segmento</td><td>spanKind</td><td>O tipo de segmento é uma propriedade do segmento que indica o tipo de segmento. Isso ajuda a entender a natureza da unidade de trabalho realizada pelo segmento.</td></tr><tr><td>Nome do Evento</td><td>eventName</td><td>Isso mapeia para a mensagem de registro.</td></tr><tr><td>Atributos do Evento</td><td>eventAttributes</td><td>Isso forma a essência dos registros de eventos, com base na operação executada, ele contém pares chave-valor formatados em JSON. Isso também inclui um atributo de classe do manipulador, para mostrar a classe do registro.</td></tr></tbody></table><p>Simples log</p><pre><code>FINE [LoggingOptions$1.lambda$export$1] - {
  &quot;traceId&quot;: &quot;fc8aef1d44b3cc8bc09eb8e581c4a8eb&quot;,
  &quot;spanId&quot;: &quot;b7d3b9865d3ddd45&quot;,
  &quot;spanKind&quot;: &quot;INTERNAL&quot;,
  &quot;eventTime&quot;: 1597819675128886121,
  &quot;eventName&quot;: &quot;Session request execution complete&quot;,
  &quot;attributes&quot;: {
    &quot;http.status_code&quot;: 200,
    &quot;http.handler_class&quot;: &quot;org.openqa.selenium.grid.router.HandleSession&quot;,
    &quot;http.url&quot;: &quot;\u002fsession\u002fdd35257f104bb43fdfb06242953f4c85&quot;,
    &quot;http.method&quot;: &quot;DELETE&quot;,
    &quot;session.id&quot;: &quot;dd35257f104bb43fdfb06242953f4c85&quot;
  }
}
</code></pre><p>Além dos campos mencionados anteriormente, com base na <a href=https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/exceptions.md>especificação do OpenTelemetry</a> os registros de erro consistem nos seguintes campos: :</p><table><thead><tr><th>Campo</th><th>Valor do Campo</th><th>Descrição</th></tr></thead><tbody><tr><td>Tipo de Exceção</td><td>exception.type</td><td>O nome da classe da exceção.</td></tr><tr><td>Mensagem da Exceção</td><td>exception.message</td><td>Motivo da exceção.</td></tr><tr><td>Rastreamento de Exceção</td><td>exception.stacktrace</td><td>Imprime a pilha de chamadas no momento em que a exceção foi lançada. Ajuda a entender a origem da exceção.</td></tr></tbody></table><p>Simples error log</p><pre><code>WARN [LoggingOptions$1.lambda$export$1] - {
  &quot;traceId&quot;: &quot;7efa5ea57e02f89cdf8de586fe09f564&quot;,
  &quot;spanId&quot;: &quot;914df6bc9a1f6e2b&quot;,
  &quot;spanKind&quot;: &quot;INTERNAL&quot;,
  &quot;eventTime&quot;: 1597820253450580272,
  &quot;eventName&quot;: &quot;exception&quot;,
  &quot;attributes&quot;: {
    &quot;exception.type&quot;: &quot;org.openqa.selenium.ScriptTimeoutException&quot;,
    &quot;exception.message&quot;: &quot;Unable to execute request: java.sql.SQLSyntaxErrorException: Table 'mysql.sessions_mappa' doesn't exist ...&quot; (full message will be printed),
    &quot;exception.stacktrace&quot;: &quot;org.openqa.selenium.ScriptTimeoutException: java.sql.SQLSyntaxErrorException: Table 'mysql.sessions_mappa' doesn't exist\nBuild info: version: '4.0.0-alpha-7', revision: 'Unknown'\nSystem info: host: 'XYZ-MacBook-Pro.local', ip: 'fe80:0:0:0:10d5:b63a:bdc6:1aff%en0', os.name: 'Mac OS X', os.arch: 'x86_64', os.version: '10.13.6', java.version: '11.0.7'\nDriver info: driver.version: unknown ....&quot; (full stack will be printed),
    &quot;http.handler_class&quot;: &quot;org.openqa.selenium.grid.distributor.remote.RemoteDistributor&quot;,
    &quot;http.url&quot;: &quot;\u002fsession&quot;,
    &quot;http.method&quot;: &quot;POST&quot;
  }
}
</code></pre><p><strong>Observação:</strong> Os logs são formatados acima para facilitar a leitura. A formatação de logs está desativada no servidor Selenium.</p><p>Os passos acima devem configurá-lo para visualizar rastreamentos e logs.</p><h2 id=referências>Referências</h2><ol><li><a href=https://lightstep.com/blog/opentelemetry-101-what-is-tracing/>Compreendendo o Rastreamento</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/api.md#status>Especificação da API de Rastreamento do OpenTelemetry</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki>Selenium Wiki</a></li><li><a href=https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/>Logs Estruturados vs. Eventos</a></li><li><a href=https://github.com/jaegertracing/jaeger>Framework Jaeger</a></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-2c82ff996091dc1dd2f15b718d6b1ede>6.2 - Suporte a buscas em GraphQL</h1><p>GraphQL é uma linguagem de consulta para APIs e um runtime para atender a essas consultas com seus dados existentes. Ele dá aos usuários o poder de pedir exatamente o que precisam e nada mais.</p><h2 id=enums>Enums</h2><p>Enums representam possíveis conjuntos de valores para um campo.</p><p>Por exemplo, o objeto <code>Node</code> possui um campo chamado<code> status</code>. O estado é um enum (especificamente, do tipo <code>Status</code>) porque pode ser<code> UP</code>, <code>DRAINING</code> ou<code> UNAVAILABLE</code>.</p><h2 id=escalares>Escalares</h2><p>Escalares são valores primitivos: <code>Int</code>,<code> Float</code>, <code>String</code>,<code> Boolean</code> ou <code>ID</code>.</p><p>Ao chamar a API GraphQL, você deve especificar o subcampo aninhado até retornar apenas escalares.</p><h2 id=estrutura-do-schema>Estrutura do Schema</h2><p>A estrutura do esquema de grade é a seguinte:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    session<span style=color:#ce5c00;font-weight:700>(</span>id: <span style=color:#4e9a06>&#34;&lt;session-id&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        id,
</span></span><span style=display:flex><span>        capabilities,
</span></span><span style=display:flex><span>        startTime,
</span></span><span style=display:flex><span>        uri,
</span></span><span style=display:flex><span>        nodeId,
</span></span><span style=display:flex><span>        nodeUri,
</span></span><span style=display:flex><span>        sessionDurationMillis
</span></span><span style=display:flex><span>        slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            id,
</span></span><span style=display:flex><span>            stereotype,
</span></span><span style=display:flex><span>            lastStarted
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    grid: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        uri,
</span></span><span style=display:flex><span>        totalSlots,
</span></span><span style=display:flex><span>        nodeCount,
</span></span><span style=display:flex><span>        maxSession,
</span></span><span style=display:flex><span>        sessionCount,
</span></span><span style=display:flex><span>        version,
</span></span><span style=display:flex><span>        sessionQueueSize
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    sessionsInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        sessionQueueRequests,
</span></span><span style=display:flex><span>        sessions: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                id,
</span></span><span style=display:flex><span>                capabilities,
</span></span><span style=display:flex><span>                startTime,
</span></span><span style=display:flex><span>                uri,
</span></span><span style=display:flex><span>                nodeId,
</span></span><span style=display:flex><span>                nodeUri,
</span></span><span style=display:flex><span>                sessionDurationMillis
</span></span><span style=display:flex><span>                slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    id,
</span></span><span style=display:flex><span>                    stereotype,
</span></span><span style=display:flex><span>                    lastStarted
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    nodesInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        nodes : <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                id,
</span></span><span style=display:flex><span>                uri,
</span></span><span style=display:flex><span>                status,
</span></span><span style=display:flex><span>                maxSession,
</span></span><span style=display:flex><span>                slotCount,
</span></span><span style=display:flex><span>                sessions: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                        id,
</span></span><span style=display:flex><span>                        capabilities,
</span></span><span style=display:flex><span>                        startTime,
</span></span><span style=display:flex><span>                        uri,
</span></span><span style=display:flex><span>                        nodeId,
</span></span><span style=display:flex><span>                        nodeUri,
</span></span><span style=display:flex><span>                        sessionDurationMillis
</span></span><span style=display:flex><span>                        slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                            id,
</span></span><span style=display:flex><span>                            stereotype,
</span></span><span style=display:flex><span>                            lastStarted
</span></span><span style=display:flex><span>                        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>]</span>,
</span></span><span style=display:flex><span>                sessionCount,
</span></span><span style=display:flex><span>                stereotypes,
</span></span><span style=display:flex><span>                version,
</span></span><span style=display:flex><span>                osInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    arch,
</span></span><span style=display:flex><span>                    name,
</span></span><span style=display:flex><span>                    version
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=consultando-graphql>Consultando GraphQL</h2><p>O melhor jeito de consultar GraphQL é utilizando requisições <code>curl</code>. GraphQL permite que você busque apenas os dados que você quer, nada mais, anda menos.</p><p>Alguns exemplos de buscas em GraphQL estão abaixo. Você pode montar as queries como quiser.</p><h3 id=buscando-o-número-total-de-slots-maxsession-e-slots-usados-sessioncount-na-grid>Buscando o número total de slots (<code>maxSession</code>) e slots usados (<code>sessionCount</code>) na Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ grid { maxSession, sessionCount } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><p>Geralmente na máquina local o <code>&lt;LINK_TO_GRAPHQL_ENDPOINT></code> será <code>http://localhost:4444/graphql</code></p><h3 id=buscando-todos-os-detalhes-da-sessão-nó-e-grid>Buscando todos os detalhes da Sessão, Nó e Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { uri, maxSession, sessionCount }, nodesInfo { nodes { id, uri, status, sessions { id, capabilities, startTime, uri, nodeId, nodeUri, sessionDurationMillis, slot { id, stereotype, lastStarted } }, slotCount, sessionCount }} }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-o-número-de-sessões-atual-na-grid>Buscando o número de sessões atual na Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { sessionCount } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-a-contagem-máxima-de-sessões-na-grid>Buscando a contagem máxima de sessões na Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { maxSession } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-todos-os-detalhes-de-todas-as-sessões-de-todos-os-nós-na-grid>Buscando todos os detalhes de todas as sessões de todos os nós na Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessions { id, capabilities, startTime, uri, nodeId, nodeId, sessionDurationMillis } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-informações-dos-slots-de-todas-as-sessões-de-cada-nó-na-grid>Buscando informações dos slots de todas as sessões de cada Nó na Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessions { id, slot { id, stereotype, lastStarted } } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-informação-da-sessão-para-uma-sessão-específica>Buscando informação da sessão para uma sessão específica:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ session (id: \&#34;&lt;session-id&gt;\&#34;) { id, capabilities, startTime, uri, nodeId, nodeUri, sessionDurationMillis, slot { id, stereotype, lastStarted } } } &#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-os-recursos-de-cada-nó-na-grid>Buscando os recursos de cada nó na Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { stereotypes } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-o-status-de-cada-nó-na-grid>Buscando o status de cada Nó na Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { status } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=buscando-a-uri-de-cada-nó-e-da-grid>Buscando a URI de cada Nó e da Grid:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { uri } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-for-getting-the-current-requests-in-the-new-session-queue>Query for getting the current requests in the New Session Queue:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessionQueueRequests } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-for-getting-the-new-session-queue-size->Query for getting the New Session Queue size :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { sessionQueueSize } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-d2d54c4f08eb016972465f2a03ead126>6.3 - Rotas da Grid</h1><h2 id=grid>Grid</h2><h3 id=status-da-grid>Status da Grid</h3><p>O status da Grid fornece o estado atual da grid. Consiste em detalhes sobre cada nó registrado.
Para cada nó, o status inclui informações sobre a disponibilidade, sessões e slots do nó.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL GET <span style=color:#4e9a06>&#39;http://localhost:4444/status&#39;</span>
</span></span></code></pre></div><h3 id=deletar-sessão>Deletar sessão</h3><p>A exclusão da sessão encerra a sessão do WebDriver, fecha o driver e o remove do mapa de sessões ativas.
Qualquer solicitação usando o id de sessão removido ou reutilizando a instância do driver gerará um erro.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/session/&lt;session-id&gt;&#39;</span>
</span></span></code></pre></div><h3 id=which-url-should-i-use>Which URL should I use?</h3><p>No modo Standalone, o URL da Grid é o endereço do servidor Standalone.</p><p>No modo Hub-Node, a URL da Grid é o endereço do servidor Hub.</p><p>No modo totalmente distribuído, a URL da Grid é o endereço do servidor do roteador.</p><p>A URL padrão para todos os modos acima é http://localhost:4444.</p><h2 id=distribuidor>Distribuidor</h2><h3 id=remover-nó>Remover Nó</h3><p>Para remover o Nó da Grid, use o comando cURL listado abaixo.
Ele não interrompe nenhuma sessão em andamento em execução nesse nó.
O Node continua rodando como está, a menos que seja explicitamente eliminado.
O Distribuidor não está mais ciente do Nó e, portanto, qualquer solicitação de nova sessão correspondente
não será encaminhado para esse Nó.</p><p>No modo Standalone, a URL do distribuidor é o endereço do servidor Standalone.</p><p>No modo Hub-Node, a URL do Distribuidor é o endereço do servidor Hub.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt; &#39;</span>
</span></span></code></pre></div><p>No modo totalmente distribuído, a URL é o endereço do servidor Router.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Se nenhum segredo de registro foi configurado durante a configuração da Grid, use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;Router-URL&gt;/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=drenar-nó>Drenar Nó</h3><p>O comando de drenagem de nó é para desligamento normal de nó.
A drenagem para o Node após a conclusão de todas as sessões em andamento.
No entanto, ele não aceita novas solicitações de sessão.</p><p>No modo Standalone, a URL do distribuidor é o endereço do servidor Standalone.</p><p>No modo Hub-Node, a URL do Distribuidor é o endereço do servidor Hub.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt; &#39;</span>
</span></span></code></pre></div><p>No modo totalmente distribuído, a URL é o endereço do servidor Router.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Se nenhum segredo de registro foi configurado durante a configuração da Grid, use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://&lt;Router-URL&gt;/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h2 id=nó>Nó</h2><p>Os terminais nesta seção são aplicáveis ao modo Hub-Node e ao modo Grid totalmente distribuída, onde o Nó é executado de forma independente.
A URL do Nó padrão é http://localhost:5555 no caso de um Nó.
No caso de vários Nós, use <a href=/pt-br/documentation/grid/advanced_features/endpoints/#grid-status>Grid status</a> para obter todos os detalhes do Nó e localizar o endereço do Nó.</p><h3 id=status>Status</h3><p>O status do Nó é essencialmente uma verificação de integridade do Nó.
O distribuidor executa ping no status do Nó em intervalos regulares e atualiza o modelo de Grid de acordo.
O status inclui informações sobre disponibilidade, sessões e slots.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:5555/status&#39;</span>
</span></span></code></pre></div><h3 id=drenagem>Drenagem</h3><p>O Distribuidor passa o comando [drain](# drain-node) para o Nó apropriado identificado pelo ID do Nó.
Para drenar o Nó diretamente, use o comando cuRL listado abaixo.
Ambos as rotas são válidas e produzem o mesmo resultado. Drenar termina as sessões em andamento antes de interromper o Nó.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Se nenhum segredo de registro foi configurado durante a configuração da Grid, use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=checar-dono-da-sessão>Checar dono da sessão</h3><p>Para verificar se uma sessão pertence a um Nó, use o comando cURL listado abaixo.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/owner/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Se nenhum segredo de registro foi configurado durante a configuração da Grid, use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/owner/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><p>Ele retornará true se a sessão pertencer ao Nó, caso contrário, retornará false.</p><h3 id=deletar-sessão-1>Deletar sessão</h3><p>A exclusão da sessão encerra a sessão do WebDriver, fecha o driver e o remove do mapa de sessões ativas.
Qualquer solicitação usando o id de sessão removido ou reutilizando a instância do driver gerará um erro.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/session/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>Se nenhum segredo de registro foi configurado durante a configuração da Grid, use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/session/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h2 id=fila-de-sessão>Fila de Sessão</h2><h3 id=limpar-a-fila-de-sessão>Limpar a Fila de Sessão</h3><p>A Fila de Sessão contém as novas solicitações de sessão.
Para limpar a fila, use o comando cURL listado abaixo.
Limpar a fila rejeita todas as solicitações na fila. Para cada solicitação, o servidor retorna uma resposta de erro ao respectivo cliente.
O resultado do comando clear é o número total de solicitações excluídas.</p><p>No modo Standalone, a URL Queue é o endereço do servidor Standalone.</p><p>No modo Hub-Node, a URL do enfileirador é o endereço do servidor Hub.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>No modo totalmente distribuído, a URL do enfileirador é o endereço do servidor do Enfileirador de Sessões.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>If no registration secret has been configured while setting up the Grid, then use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;Router-URL&gt;/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=obter-novos-pedidos-da-fila-de-sessão>Obter novos pedidos da Fila de Sessão</h3><p>Novos pedidos da Fila de Sessão contém os novos pedidos de sessão.
Para obter os pedidos na Fila, utiliza o comando cURL listado abaixo.
É retornado o número total de pedidos na Fila.</p><p>No modo Standalone, a URL é a do servidor, em modo Grid, a URL será a do HUB.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span>
</span></span></code></pre></div><p>No modo totalmente distribuido, a URL da Fila é a porta do servidor de Fila.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-f1b80d80b2bcdc1e194f0d4fc033093e>6.4 - Personalizando um Nó</h1><h2 id=como-personalizar-um-nó>Como personalizar um Nó</h2><p>Há momentos em que gostaríamos de personalizar um Nó de acordo com nossas necessidades.</p><p>Por exemplo, podemos desejar fazer alguma configuração adicional antes que uma sessão comece a ser executada e executar alguma limpeza após o término de uma sessão.</p><p>Os seguintes passos podem ser seguidos para isso:</p><ul><li><p>Crie uma classe que estenda <code>org.openqa.selenium.grid.node.Node</code>.</p></li><li><p>Adicione um método estático (este será nosso método de fábrica) à classe recém-criada, cuja assinatura se parece com esta:</p><p><code>public static Node create(Config config)</code>. Here:</p><ul><li><code>Node</code> é do tipo <code>org.openqa.selenium.grid.node.Node</code></li><li><code>Config</code> é do tipo <code>org.openqa.selenium.grid.config.Config</code></li></ul></li></ul><ul><li>Dentro deste método de fábrica, inclua a lógica para criar sua nova classe..</li><li>TPara incorporar esta nova lógica personalizada no hub, inicie o nó e passe o nome da classe totalmente qualificado da classe acima como argumento. <code>--node-implementation</code></li></ul><p>Vamos ver um exemplo de tudo isso:</p><h3 id=node-personalizado-como-um-uber-jar>Node personalizado como um uber jar</h3><ol><li>Crie um projeto de exemplo usando sua ferramenta de construção favorita. (<strong>Maven</strong>|<strong>Gradle</strong>).</li><li>Adicione a seguinte dependência ao seu projeto de exemplo..<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-grid>org.seleniumhq.selenium/selenium-grid</a></li></ul></li><li>Adicione o seu nó personalizado ao projeto.</li><li>Construir algo. <a href=https://imagej.net/develop/uber-jars>uber jar</a> Para ser capaz de iniciar o Node usando o comando <code>java -jar</code>.</li><li>Agora inicie o nó usando o comando:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar custom_node-server.jar node <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--node-implementation org.seleniumhq.samples.DecoratedLoggingNode
</span></span></code></pre></div><p><strong>Observação:</strong> Se estiver usando o Maven como ferramenta de construção, é preferível usar o <a href=https://maven.apache.org/plugins/maven-shade-plugin>maven-shade-plugin</a> em vez do <a href=https://maven.apache.org/plugins/maven-assembly-plugin>maven-assembly-plugin</a> porque o plugin maven-assembly parece ter problemas para mesclar vários arquivos de Service Provider Interface (<code>META-INF/services</code>).</p><h3 id=node-personalizado-como-jar>Node personalizado como jar</h3><ol><li>Crie um projeto de exemplo usando a sua ferramenta de construção favorita (<strong>Maven</strong>|<strong>Gradle</strong>).</li><li>Adicione a seguinte dependência ao seu projeto de exemplo:<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-grid>org.seleniumhq.selenium/selenium-grid</a></li></ul></li><li>Adicione o seu Node personalizado ao projeto.</li><li>Construa um arquivo JAR do seu projeto usando a sua ferramenta de construção.</li><li>Agora, inicie o Node usando o seguinte comando:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar selenium-server-4.6.0.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext custom_node-1.0-SNAPSHOT.jar node <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--node-implementation org.seleniumhq.samples.DecoratedLoggingNode
</span></span></code></pre></div><p>Aqui está um exemplo que apenas imprime algumas mensagens no console sempre que houver uma atividade de interesse (sessão criada, sessão excluída, execução de um comando do webdriver, etc.) no Node.</p><details><summary>Sample customized node</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.seleniumhq.samples</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.net.URI</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.util.UUID</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.Capabilities</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.NoSuchSessionException</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.WebDriverException</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.config.Config</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.CreateSessionRequest</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.CreateSessionResponse</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.NodeId</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.NodeStatus</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.Session</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.log.LoggingOptions</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.node.HealthCheck</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.node.Node</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.node.local.LocalNodeFactory</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.security.Secret</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.security.SecretOptions</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.server.BaseServerOptions</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.internal.Either</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.SessionId</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpRequest</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpResponse</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.tracing.Tracer</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DecoratedLoggingNode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DecoratedLoggingNode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Tracer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tracer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodeId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URI</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Secret</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>registrationSecret</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Duration</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionTimeout</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tracer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>registrationSecret</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionTimeout</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>create</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>LoggingOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>loggingOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoggingOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>BaseServerOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>serverOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BaseServerOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>URI</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uri</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>serverOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExternalUri</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>SecretOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secretOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SecretOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>NodeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodeOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Duration</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionTimeout</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getSessionTimeout</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Refer to the foot notes for additional context on this line.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LocalNodeFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>create</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>DecoratedLoggingNode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wrapper</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DecoratedLoggingNode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>loggingOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getTracer</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getId</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>secretOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getRegistrationSecret</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>sessionTimeout</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>wrapper</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wrapper</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>WebDriverException</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CreateSessionResponse</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>newSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>CreateSessionRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionRequest</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before newSession()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>newSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sessionRequest</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After newSession()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executeWebDriverCommand</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>HttpRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before executeWebDriverCommand(): &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUri</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>executeWebDriverCommand</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After executeWebDriverCommand()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Session</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSuchSessionException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before getSession()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After getSession()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uploadFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>HttpRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before uploadFile()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>uploadFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After uploadFile()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stop</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSuchSessionException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before stop()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>stop</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After stop()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isSessionOwner</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before isSessionOwner()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>isSessionOwner</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After isSessionOwner()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isSupporting</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Capabilities</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>capabilities</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before isSupporting&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>isSupporting</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>capabilities</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After isSupporting()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodeStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getStatus</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before getStatus()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After getStatus()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HealthCheck</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getHealthCheck</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before getHealthCheck()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getHealthCheck</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After getHealthCheck()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>drain</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before drain()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>drain</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After drain()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isReady</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Before isReady()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>isReady</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;After isReady()&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></details><p><strong><em>Notas de Rodapé:</em></strong></p><p>No exemplo acima, a linha <code>Node node = LocalNodeFactory.create(config);</code> cria explicitamente um <code>LocalNode</code>.</p><p>Basicamente, existem 2 tipos de implementações <em>visíveis para o usuário</em> de <code>org.openqa.selenium.grid.node.Node</code> disponíveis.</p><p>Essas classes são bons pontos de partida para aprender como criar um Node personalizado e também para compreender os detalhes internos de um Node.</p><ul><li><code>org.openqa.selenium.grid.node.local.LocalNode</code> - Usado para representar um Node de execução contínua e é a implementação padrão que é usada quando você inicia um <code>node</code>.<ul><li>Pode ser criado chamando <code>LocalNodeFactory.create(config);</code>, onde:<ul><li><code>LocalNodeFactory</code> pertence a <code>org.openqa.selenium.grid.node.local</code></li><li><code>Config</code> pertence a <code>org.openqa.selenium.grid.config</code></li></ul></li></ul></li><li><code>org.openqa.selenium.grid.node.k8s.OneShotNode</code> - Esta é uma implementação de referência especial em que o Node encerra-se graciosamente após atender a uma sessão de teste. Esta classe atualmente não está disponível como parte de nenhum artefato Maven pré-construído.<ul><li>Você pode consultar o código-fonte <a href=https://github.com/SeleniumHQ/selenium/blob/trunk/java/src/org/openqa/selenium/grid/node/k8s/OneShotNode.java>aqui</a> para entender seus detalhes internos.</li><li>Para construí-lo localmente, consulte <a href=https://github.com/SeleniumHQ/selenium/blob/trunk/deploys/k8s/README.md>aqui</a>.</li><li>Pode ser criado chamando <code>OneShotNode.create(config)</code>, onde:<ul><li><code>OneShotNode</code> pertence a <code>org.openqa.selenium.grid.node.k8s</code></li><li><code>Config</code> pertence a <code>org.openqa.selenium.grid.config</code></li></ul></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-538b88406bce5817973473bd612380c3>6.5 - External datastore</h1><div class="pageinfo pageinfo-warning"><p class=lead><i class="fas fa-language d-4"></i>
Page being translated from
English to Portuguese. Do you speak Portuguese? Help us to translate
it by sending us pull requests!</p></div><h2 id=table-of-contents>Table of Contents</h2><ul><li><a href=/pt-br/documentation/grid/advanced_features/external_datastore/#introduction>Introduction</a></li><li><a href=/pt-br/documentation/grid/advanced_features/external_datastore/#setup>Setup</a></li><li><a href=/pt-br/documentation/grid/advanced_features/external_datastore/#database-backed-session-map>Database backed Session Map</a><ul><li><a href=/pt-br/documentation/grid/advanced_features/external_datastore/#steps>Steps</a></li></ul></li><li><a href=/pt-br/documentation/grid/advanced_features/external_datastore/#redis-backed-session-map>Redis backed Session Map</a><ul><li><a href=/pt-br/documentation/grid/advanced_features/external_datastore/#steps>Steps</a></li></ul></li></ul><h2 id=introduction>Introduction</h2><p>Selenium Grid allows you to persist information related to currently running sessions into an external data store.
The external data store could be backed by your favourite database (or) Redis Cache system.</p><h2 id=setup>Setup</h2><ul><li><a href=https://get-coursier.io/docs/cli-installation>Coursier</a> - As a dependency resolver, so that we can download maven artifacts on the fly and make them available in our classpath</li><li><a href=https://docs.docker.com/engine/install/>Docker</a> - To manage our PostGreSQL/Redis docker containers.</li></ul><h2 id=database-backed-session-map>Database backed Session Map</h2><p>For the sake of this illustration, we are going to work with PostGreSQL database.</p><p>We will spin off a PostGreSQL database as a docker container using a docker compose file.</p><h3 id=steps>Steps</h3><p>You can skip this step if you already have a PostGreSQL database instance available at your disposal.</p><ul><li>Create a sql file named <code>init.sql</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessions_map</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_ids</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_caps</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_uri</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_stereotype</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_start</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>In the same directory as the <code>init.sql</code>, create a file named <code>docker-compose.yml</code> with its contents as below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.8&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>postgres:9.6-bullseye</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>restart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>always</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_USER=seluser</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_PASSWORD=seluser</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_DB=selenium_sessions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;5432:5432&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>./init.sql:/docker-entrypoint-initdb.d/init.sql</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We can now start our database container by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><p><em>Our database name is <code>selenium_sessions</code> with its username and password set to <code>seluser</code></em></p><p>If you are working with an already running PostGreSQL DB instance, then you just need to create a database named <code>selenium_sessions</code> and the table <code>sessions_map</code> using the above mentioned SQL statement.</p><ul><li>Create a Selenium Grid configuration file named <code>sessions.toml</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessions</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>implementation</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;org.openqa.selenium.grid.sessionmap.jdbc.JdbcBackedSessionMap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-url</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbc:postgresql://localhost:5432/selenium_sessions&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-user</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;seluser&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-password</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;seluser&#34;</span>
</span></span></code></pre></div><p><em>Note:</em> If you plan to use an existing PostGreSQL DB instance, then replace <code>localhost:5432</code> with the actual host and port number of your instance.</p><ul><li>Below is a simple shell script (let&rsquo;s call it <code>distributed.sh</code>) that we will use to bring up our distributed Grid.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span><span style=color:#000>JAR_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar
</span></span><span style=display:flex><span><span style=color:#000>PUBLISH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--publish-events tcp://localhost:4442&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SUBSCRIBE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--subscribe-events tcp://localhost:4443&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessions http://localhost:5556&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS_QUEUE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessionqueue http://localhost:5559&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Event Bus&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> event-bus <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5557</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting New Session Queue&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Sessions Map&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-jdbc:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span> org.postgresql:postgresql:42.3.1<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Distributor&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span>  distributor <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000>$SESSIONS</span> <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Router&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> router <span style=color:#000>$SESSIONS</span> --distributor http://localhost:5553 <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>4444</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Node&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> node <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><ul><li><p>At this point the current directory should contain the following files:</p><ul><li><code>docker-compose.yml</code></li><li><code>init.sql</code></li><li><code>sessions.toml</code></li><li><code>distributed.sh</code></li></ul></li><li><p>You can now spawn the Grid by running <code>distributed.sh</code> shell script and quickly run a test. You will notice that the Grid now stores session information into the PostGreSQL database.</p></li></ul><p>In the line which spawns a <code>SessionMap</code> on a machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span>java -jar selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-jdbc:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span> org.postgresql:postgresql:42.3.1<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions --publish-events tcp://localhost:4442 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--subscribe-events tcp://localhost:4443 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml 
</span></span></code></pre></div><ul><li>The variable names from the above script have been replaced with their actual values for clarity.</li><li>Remember to substitute <code>localhost</code> with the actual hostname of the machine where your <code>Event-Bus</code> is running.</li><li>The arguments being passed to <code>coursier</code> are basically the GAV (Group Artifact Version) Maven co-ordinates of:<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-session-map-jdbc>selenium-session-map-jdbc</a> which is needed to help us store sessions information in database</li><li><a href=https://mvnrepository.com/artifact/org.postgresql/postgresql>postgresql</a> which is needed to help us talk PostGreSQL database.</li></ul></li><li><code>sessions.toml</code> is the configuration file that we created earlier.</li></ul><h2 id=redis-backed-session-map>Redis backed Session Map</h2><p>We will spin off a Redis Cache docker container using a docker compose file.</p><h3 id=steps-1>Steps</h3><p>You can skip this step if you already have a Redis Cache instance available at your disposal.</p><ul><li>Create a file named <code>docker-compose.yml</code> with its contents as below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.8&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>redis</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redis:bullseye</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>restart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>always</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;6379:6379&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We can now start our Redis container by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><ul><li>Create a Selenium Grid configuration file named <code>sessions.toml</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessions</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>scheme</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;redis&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>implementation</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;org.openqa.selenium.grid.sessionmap.redis.RedisBackedSessionMap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>hostname</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;localhost&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>port</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6379</span>
</span></span></code></pre></div><p><em>Note:</em> If you plan to use an existing Redis Cache instance, then replace <code>localhost</code> and <code>6379</code> with the actual host and port number of your instance.</p><ul><li>Below is a simple shell script (let&rsquo;s call it <code>distributed.sh</code>) that we will use to bring up our distributed grid.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span><span style=color:#000>JAR_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar
</span></span><span style=display:flex><span><span style=color:#000>PUBLISH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--publish-events tcp://localhost:4442&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SUBSCRIBE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--subscribe-events tcp://localhost:4443&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessions http://localhost:5556&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS_QUEUE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessionqueue http://localhost:5559&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Event Bus&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> event-bus <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5557</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting New Session Queue&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Session Map&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-redis:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span><span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Distributor&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span>  distributor <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000>$SESSIONS</span> <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Router&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> router <span style=color:#000>$SESSIONS</span> --distributor http://localhost:5553 <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>4444</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Node&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> node <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><ul><li><p>At this point the current directory should contain the following files:</p><ul><li><code>docker-compose.yml</code></li><li><code>sessions.toml</code></li><li><code>distributed.sh</code></li></ul></li><li><p>You can now spawn the Grid by running <code>distributed.sh</code> shell script and quickly run a test. You will notice that the Grid now stores session information into the Redis instance. You can perhaps make use of a Redis GUI such as <a href=https://tableplus.com/>TablePlus</a> to see them (Make sure that you have setup a debug point in your test, because the values will get deleted as soon as the test runs to completion).</p></li></ul><p>In the line which spawns a <code>SessionMap</code> on a machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span>java -jar selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-redis:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span><span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions --publish-events tcp://localhost:4442 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--subscribe-events tcp://localhost:4443 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml 
</span></span></code></pre></div><ul><li>The variable names from the above script have been replaced with their actual values for clarity.</li><li>Remember to substitute <code>localhost</code> with the actual hostname of the machine where your <code>Event-Bus</code> is running.</li><li>The arguments being passed to <code>coursier</code> are basically the GAV (Group Artifact Version) Maven co-ordinates of:<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-session-map-redis>selenium-session-map-redis</a> which is needed to help us store sessions information in Redis Cache.</li></ul></li><li><code>sessions.toml</code> is the configuration file that we created earlier.</li></ul></div></main></div></div><div class="row justify-content-center p-5"><h2 class="selenium text-center" id=dev-partners>Development Partners</h2></div><div class="row justify-content-around pt-4 pb-5 px-5"><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://www.browserstack.com/automate?utm_campaign=open-source-sponsor&amp;utm_campaigncode=701OW000009sQwVYAU&amp;utm_medium=partnered&amp;utm_source=seleniumorg" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/browserstack.png alt=BrowserStack title=BrowserStack></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://saucelabs.com/resources/topic-hub/selenium?utm_source=selenium&amp;utm_medium=website&amp;utm_campaign=selenium-sponsorship-fy25" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/saucelabs.png alt="Sauce Labs" title="Sauce Labs"></a></div></div><div class="row justify-content-center p-5"><h2 class="selenium text-center" id=selenium-level>Selenium Level Sponsors</h2></div><div class="row justify-content-around pt-4 pb-5 px-5"><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://brightdata.com/?utm_source=brand&amp;utm_campaign=brnd-mkt_partners_selenium" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/bright-data.png alt="Bright Data" title="Bright Data"></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href=https://applitools.com/ class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/applitools.png alt=Applitools title=Applitools></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://www.lambdatest.com/selenium-automation?utm_source=selenium&amp;utm_medium=open-source-sponsor&amp;utm_campaign=nov_14&amp;utm_term=sk&amp;utm_content=web" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/lambda-test.png alt=LambdaTest title=LambdaTest></a></div></div><div class="row justify-content-center pt-2 pb-3 -bg-selenium-cyan"><div class="card text-center border-0 bg-transparent py-5"><div class="card-body text-white"><h2 class=card-title>Support the Selenium Project</h2><p class=card-text>Learn more or view the full list of sponsors.</p><div class=selenium-button-container><a href=/sponsors class="selenium-button selenium-white-cyan text-uppercase fw-bold">Learn more
<i class="ps-3 fas fa-caret-right"></i></a></div></div></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/group/selenium-users aria-label="User mailing list"><i class="fas fa-mail-bulk"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Selenium in Twitter" aria-label="Selenium in Twitter"><a class=text-white target=_blank rel=noopener href=https://twitter.com/SeleniumHQ aria-label="Selenium in Twitter"><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="SeleniumConf YouTube Channel" aria-label="SeleniumConf YouTube Channel"><a class=text-white target=_blank rel=noopener href=https://www.youtube.com/channel/UCbDlgX_613xNMrDqCe3QNEw aria-label="SeleniumConf YouTube Channel"><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Software Freedom Conservancy" aria-label="Software Freedom Conservancy"><a class=text-white target=_blank rel=noopener href=mailto:selenium@sfconservancy.org aria-label="Software Freedom Conservancy"><i class="fas fa-envelope-square"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/seleniumhq/selenium aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://join.slack.com/t/seleniumhq/shared_invite/zt-2stlcmc6b-Hww~3r3yAzquhSq4riOFxA aria-label=Slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=IRC aria-label=IRC><a class=text-white target=_blank rel=noopener href=https://kiwiirc.com/nextclient/irc.libera.chat/#selenium aria-label=IRC><i class="fas fa-comments"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/selenium-developers aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><a href=https://www.netlify.com><img style=margin-right:50px src=https://www.netlify.com/v3/img/components/netlify-light.svg alt="Deploys by Netlify"></a></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Software Freedom Conservancy Todos os direitos reservados</small><p class=mt-2><a href=/pt-br/documentation/about/>Sobre esta documentação</a></p></div></div></div></footer></div><script src=/js/main.min.0a56205ed1c75268f017591e5418fdb944578a279fe7c7abe3981ebed191c341.js integrity="sha256-ClYgXtHHUmjwF1keVBj9uURXiief58er45gevtGRw0E=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3.6.0 integrity="sha512-FtDaTWf3IS29TLuYzTPlytjGqcXkwrzG9ivq7xXElnOZeiYTbcIy/hwXAgrrRNnI0+PfN+WFz4/+4phhJmuS8Q==" crossorigin=anonymous></script><script type=text/javascript>const containers=["#docsearch-0","#docsearch-1"];for(let e of containers)docsearch({container:e,appId:"6IOXA5JK7Z",apiKey:"2b44a1d3530f9951dd6502059058984a",indexName:"selenium"})</script><script src=/js/tabpane-persist.js></script></body></html>