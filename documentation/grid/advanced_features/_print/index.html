<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://www.selenium.dev/documentation/grid/advanced_features/><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Advanced features of Selenium | Selenium</title>
<meta name=description content="To get all the details of the advanced features, understand how it works, and how to set up your own, please browse thorough the following sections.
"><meta property="og:url" content="https://www.selenium.dev/documentation/grid/advanced_features/"><meta property="og:site_name" content="Selenium"><meta property="og:title" content="Advanced features of Selenium"><meta property="og:description" content="To get all the details of the advanced features, understand how it works, and how to set up your own, please browse thorough the following sections."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://www.selenium.dev/images/selenium_4_logo.png"><meta itemprop=name content="Advanced features of Selenium"><meta itemprop=description content="To get all the details of the advanced features, understand how it works, and how to set up your own, please browse thorough the following sections.
"><meta itemprop=dateModified content="2021-12-07T06:38:55-06:00"><meta itemprop=image content="https://www.selenium.dev/images/selenium_4_logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.selenium.dev/images/selenium_4_logo.png"><meta name=twitter:title content="Advanced features of Selenium"><meta name=twitter:description content="To get all the details of the advanced features, understand how it works, and how to set up your own, please browse thorough the following sections.
"><link rel=preload href=/scss/main.min.fd681802c710400e4a80e7b05f52131ed32ee635cc502b20a496c56fb93c750f.css as=style><link href=/scss/main.min.fd681802c710400e4a80e7b05f52131ed32ee635cc502b20a496c56fb93c750f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@docsearch/css@3.6.0 integrity="sha512-AyDFDkYyALC5qoao077IqAOV7UC4oKCBTp+mJfjIt306AIRoBxoEZYDo0kAx/R7RbT+3EYEky1po/F1w1eQt7g==" crossorigin=anonymous><script defer data-domain=selenium.dev src=https://plausible.io/js/plausible.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand-lg navbar-light bg-white flex-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 139.38 34"><defs><style>.cls-1{fill:#43b02a}</style></defs><title>Selenium logo green</title><path class="cls-1" d="M46.2 26.37a18.85 18.85.0 01-2.57-.2 25 25 0 01-2.74-.53v-1.39a25.31 25.31.0 002.71.53 18 18 0 002.5.2 5.51 5.51.0 003.29-.84 2.79 2.79.0 001.14-2.39 2.85 2.85.0 00-1.24-2.49A6 6 0 0048 18.55q-.78-.29-1.67-.55A15.93 15.93.0 0144 17.13a5.92 5.92.0 01-1.58-1.05 3.6 3.6.0 01-.9-1.34A5 5 0 0141.23 13a4.46 4.46.0 01.41-1.93 4.31 4.31.0 011.17-1.5 5.26 5.26.0 011.82-1A8 8 0 0147 8.28a20.51 20.51.0 014.41.57v1.42a20 20 0 00-2.23-.44 15.2 15.2.0 00-2-.15 4.86 4.86.0 00-3.08.9A2.9 2.9.0 0042.88 13a3.25 3.25.0 00.21 1.21 2.61 2.61.0 00.7 1 4.83 4.83.0 001.27.79 14.31 14.31.0 002 .68q1.11.33 2.06.71a6.21 6.21.0 011.65.94 4.09 4.09.0 011.1 1.38 4.54 4.54.0 01.4 2 4.15 4.15.0 01-1.56 3.48A7.16 7.16.0 0146.2 26.37z"/><path class="cls-1" d="M60.62 26.32a5.46 5.46.0 01-4.28-1.62A6.9 6.9.0 0154.88 20a7.8 7.8.0 011.43-5 5 5 0 014.14-1.75 4.24 4.24.0 013.47 1.43A6.48 6.48.0 0165.1 18.8q0 .54.0.92a3.22 3.22.0 01-.09.64H56.44a5.39 5.39.0 001.17 3.5A4.18 4.18.0 0060.8 25a10.52 10.52.0 001.82-.17 11.77 11.77.0 001.93-.52l.12 1.27a10.68 10.68.0 01-2 .55A11.47 11.47.0 0160.62 26.32zM60.4 14.43q-3.68.0-3.94 4.74h7.15a6.49 6.49.0 00-.78-3.63A2.76 2.76.0 0060.4 14.43z"/><path class="cls-1" d="M68.64 7h1.58V26.11H68.64z"/><path class="cls-1" d="M79.56 26.32a5.46 5.46.0 01-4.28-1.62A6.9 6.9.0 0173.83 20a7.8 7.8.0 011.43-5 5 5 0 014.14-1.75 4.24 4.24.0 013.47 1.43A6.48 6.48.0 0184 18.8q0 .54.0.92a3.22 3.22.0 01-.09.64H75.38a5.4 5.4.0 001.17 3.5A4.18 4.18.0 0079.75 25a10.52 10.52.0 001.82-.17 11.8 11.8.0 001.93-.52l.12 1.27a10.68 10.68.0 01-2 .55A11.47 11.47.0 0179.56 26.32zm-.21-11.89q-3.68.0-3.94 4.74h7.15a6.49 6.49.0 00-.78-3.63A2.76 2.76.0 0079.35 14.43z"/><path class="cls-1" d="M87.51 13.37h1.32l.12 1.49h.12q.94-.45 1.72-.78t1.43-.54a8.42 8.42.0 011.2-.31 6.54 6.54.0 011.1-.09A3.3 3.3.0 0197 14a3.63 3.63.0 01.83 2.63v9.51H96.24v-9a3 3 0 00-.55-2 2.18 2.18.0 00-1.69-.6 7.25 7.25.0 00-2.24.41 20.1 20.1.0 00-2.67 1.12v10H87.51z"/><path class="cls-1" d="M102.75 10.52a.93.93.0 01-1.06-1 1.06 1.06.0 012.12.0.93.93.0 01-1.06 1zm-.8 2.85h1.58V26.11h-1.58z"/><path class="cls-1" d="M110.81 26.34q-3.14.0-3.14-3.47v-9.5h1.58v9a3.16 3.16.0 00.48 2 1.92 1.92.0 001.59.6 6.83 6.83.0 002.48-.48q1.25-.48 2.59-1.14V13.37H118V26.11h-1.32l-.12-1.58h-.09l-1.73.81q-.74.34-1.38.57a7.9 7.9.0 01-1.23.33A7.34 7.34.0 01110.81 26.34z"/><path class="cls-1" d="M122.18 13.37h1.3l.14 1.49h.09a19.53 19.53.0 012.58-1.31 5.51 5.51.0 012-.41 2.83 2.83.0 013 1.77h.12q.8-.5 1.45-.83a12.61 12.61.0 011.2-.54 6.17 6.17.0 011-.31 5.18 5.18.0 011-.09 3.3 3.3.0 012.45.84 3.63 3.63.0 01.83 2.63v9.51h-1.56v-9a2.9 2.9.0 00-.55-2 2.21 2.21.0 00-1.69-.59 5.14 5.14.0 00-1.78.38A14.45 14.45.0 00131.6 16v10.1H130v-9a2.9 2.9.0 00-.55-2 2.21 2.21.0 00-1.69-.59 5.24 5.24.0 00-1.86.4A14 14 0 00123.76 16V26.11h-1.58z"/><path class="cls-1" d="M21.45 21.51a2.49 2.49.0 00-2.55 2.21.08.08.0 00.08.1h4.95a.08.08.0 00.08-.09 2.41 2.41.0 00-2.56-2.22z"/><path class="cls-1" d="M32.06 4.91 21.56 16.7a.32.32.0 01-.47.0l-5.36-5.53a.32.32.0 010-.4L17.5 8.5a.32.32.0 01.52.0l3 3.32a.32.32.0 00.49.0L29.87.36A.23.23.0 0029.69.0H.25A.25.25.0 000 .25v33.5A.25.25.0 00.25 34h32a.25.25.0 00.25-.25V5.06A.23.23.0 0032.06 4.91zm-23 25.36a8.08 8.08.0 01-5.74-2 .31.31.0 010-.41l1.25-1.75A.31.31.0 015 26a6.15 6.15.0 004.2 1.64c1.64.0 2.44-.76 2.44-1.56.0-2.48-8.08-.78-8.08-6.06.0-2.33 2-4.27 5.32-4.27a7.88 7.88.0 015.25 1.76.31.31.0 010 .43L12.9 19.65a.31.31.0 01-.45.05 6.08 6.08.0 00-3.84-1.32c-1.28.0-2 .57-2 1.41.0 2.23 8.06.74 8.06 6C14.67 28.33 12.84 30.27 9.05 30.27zM26.68 25.4a.27.27.0 01-.28.28H19a.09.09.0 00-.08.1 2.81 2.81.0 003 2.32 4.62 4.62.0 002.56-.84.27.27.0 01.4.06l.9 1.31a.28.28.0 01-.06.37 6.67 6.67.0 01-4.1 1.28 5.28 5.28.0 01-5.57-5.48 5.31 5.31.0 015.4-5.46c3.11.0 5.22 2.33 5.22 5.74z"/></svg></span>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#main_navbar aria-controls=main_navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-end" id=main_navbar><ul class="navbar-nav mr-4 mb-2 mb-lg-0 ps-4 ps-lg-2"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>About</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/about>About Selenium</a>
<a class=dropdown-item href=/project>Structure and Governance</a>
<a class=dropdown-item href=/events>Events</a>
<a class=dropdown-item href=/ecosystem>Ecosystem</a>
<a class=dropdown-item href=/history>History</a>
<a class=dropdown-item href=/getinvolved>Get Involved</a>
<a class=dropdown-item href=/sponsors>Sponsors</a>
<a class=dropdown-item href=/sponsor>Sponsor Us</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/downloads><span>Downloads</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/documentation><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/projects><span>Projects</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/support><span>Support</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/pt-br/documentation/grid/advanced_features/>Português (Brasileiro)</a></li><li><a class=dropdown-item href=/zh-cn/documentation/grid/advanced_features/>中文简体</a></li><li><a class=dropdown-item href=/ja/documentation/grid/advanced_features/>日本語</a></li></ul></div></li></ul><div class=navbar-nav><div class=td-search><div class=td-search--algolia id=docsearch-1></div></div></div></div></nav><section id=announcement-banner class="alert-static g-0 row -bg-selenium-blue"><div class="container g-0" style=padding:10px><div class="row g-0 justify-content-center"><div class="alert alert-selenium-blue col-12 fade show mb-0 p-0 -bg-selenium-blue" role=alert><h4 class="alert-heading text-center m-2">Selenium Conf 2025 Call for Proposals is now open! Submissions close 01 Dec, 2024.
<a href="https://seleniumconf.com/?utm_medium=Referral&utm_source=selenium.dev&utm_campaign=cfp" target=_blank aria-pressed=true>Learn more & submit!</a></h4></div></div></div></section></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/documentation/grid/advanced_features/>Return to the regular view of this page</a>.</p></div><h1 class=title>Advanced features of Selenium</h1><div class=lead>To get all the details of the advanced features, understand how it works, and how to set up your own, please browse thorough the following sections.</div><ul><li>1: <a href=#pg-31c8fbb2badbe02b79aa5e8066e4dbb4>Observability in Selenium Grid</a></li><li>2: <a href=#pg-76186a5d24597c9acf1bcb112d5b8cb6>GraphQL query support</a></li><li>3: <a href=#pg-69471da8f601bc6b170f1ec47d69f853>Grid endpoints</a></li><li>4: <a href=#pg-abdf1d3e182274141e4d8a3e7686dcf8>Customizing a Node</a></li><li>5: <a href=#pg-fe0209b2f377f5b9f5e592aade250b62>External datastore</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-31c8fbb2badbe02b79aa5e8066e4dbb4>1 - Observability in Selenium Grid</h1><h2 id=table-of-contents>Table of Contents</h2><ul><li><a href=/documentation/grid/advanced_features/observability/#selenium-grid>Selenium Grid</a></li><li><a href=/documentation/grid/advanced_features/observability/#observability>Observability</a><ul><li><a href=/documentation/grid/advanced_features/observability/#distributed-tracing>Distributed tracing</a></li><li><a href=/documentation/grid/advanced_features/observability/#event-logging>Event logging</a></li></ul></li><li><a href=/documentation/grid/advanced_features/observability/#grid-observability>Grid Observability</a><ul><li><a href=/documentation/grid/advanced_features/observability/#visualizing-traces>Visualizing Traces</a></li><li><a href=/documentation/grid/advanced_features/observability/#leveraging-event-logs>Leveraging event logs</a></li></ul></li><li><a href=/documentation/grid/advanced_features/observability/#references>References</a></li></ul><h2 id=selenium-grid>Selenium Grid</h2><p>Grid aids in scaling and distributing tests by executing tests on various browser and operating system combinations.</p><h2 id=observability>Observability</h2><p>Observability has three pillars: traces, metrics and logs. Since Selenium Grid 4 is designed to be fully distributed, observability will make it easier to understand and debug the internals.</p><h2 id=distributed-tracing>Distributed tracing</h2><p>A single request or transaction spans multiple services and components. Tracing tracks the request lifecycle as each service executes the request. It is useful in debugging in an error scenario.
Some key terms used in tracing context are:</p><p><strong>Trace</strong>
Tracing allows one to trace a request through multiple services, starting from its origin to its final destination. This request&rsquo;s journey helps in debugging, monitoring the end-to-end flow, and identifying failures. A trace depicts the end-to-end request flow. Each trace has a unique id as its identifier.</p><p><strong>Span</strong>
Each trace is made up of timed operations called spans. A span has a start and end time and it represents operations done by a service. The granularity of span depends on how it is instrumented. Each span has a unique identifier. All spans within a trace have the same trace id.</p><p><strong>Span Attributes</strong>
Span attributes are key-value pairs which provide additional information about each span.</p><p><strong>Events</strong>
Events are timed-stamped logs within a span. They provide additional context to the existing spans. Events also contain key-value pairs as event attributes.</p><h2 id=event-logging>Event logging</h2><p>Logging is essential to debug an application. Logging is often done in a human-readable format. But for machines to search and analyze the logs, it has to have a well-defined format. Structured logging is a common practice of recording logs consistently in a fixed format. It commonly contains fields like:</p><ul><li>Timestamp</li><li>Logging level</li><li>Logger class</li><li>Log message (This is further broken down into fields relevant to the operation where the log was recorded)</li></ul><p>Logs and events are closely related. Events encapsulate all the possible information available to do a single unit of work. Logs are essentially subsets of an event. At the crux, both aid in debugging.
Refer following resources for detailed understanding:</p><ol><li><a href=https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/>https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/</a></li><li><a href=https://charity.wtf/2019/02/05/logs-vs-structured-events/>https://charity.wtf/2019/02/05/logs-vs-structured-events/</a></li></ol><h2 id=grid-observability>Grid Observability</h2><p>Selenium server is instrumented with tracing using OpenTelemetry. Every request to the server is traced from start to end. Each trace consists of a series of spans as a request is executed within the server.
Most spans in the Selenium server consist of two events:</p><ol><li>Normal event - records all information about a unit of work and marks successful completion of the work.</li><li>Error event - records all information till the error occurs and then records the error information. Marks an exception event.</li></ol><p>Running Selenium server</p><ol><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#standalone-mode>Standalone</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#hub-and-node>Hub and Node</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#fully-distributed>Fully Distributed</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki/Selenium-Grid-4#using-docker>Docker</a></li></ol><h2 id=visualizing-traces>Visualizing Traces</h2><p>All spans, events and their respective attributes are part of a trace. Tracing works while running the server in all of the above-mentioned modes.</p><p>By default, tracing is enabled in the Selenium server. Selenium server exports the traces via two exporters:</p><ol><li>Console - Logs all traces and their included spans at FINE level. By default, Selenium server prints logs at INFO level and above.
The <strong>log-level</strong> flag can be used to pass a logging level of choice while running the Selenium Grid jar/s.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-4.0.0-&lt;selenium-version&gt;.jar standalone --log-level FINE
</span></span></code></pre></div><ol start=2><li>Jaeger UI - OpenTelemetry provides the APIs and SDKs to instrument traces in the code. Whereas Jaeger is a tracing backend, that aids in collecting the tracing telemetry data and providing querying, filtering and visualizing features for the data.</li></ol><p>Detailed instructions of visualizing traces using Jaeger UI can be obtained by running the command :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>java -jar selenium-server-4.0.0-&lt;selenium-version&gt;.jar info tracing
</span></span></code></pre></div><p><a href=https://github.com/manoj9788/tracing-selenium-grid>A very good example and scripts to run the server and send traces to Jaeger</a></p><h2 id=leveraging-event-logs>Leveraging event logs</h2><p>Tracing has to be enabled for event logging as well, even if one does not wish to export traces to visualize them.<br><strong>By default, tracing is enabled. No additional parameters need to be passed to see logs on the console.</strong>
All events within a span are logged at FINE level. Error events are logged at WARN level.</p><p>All event logs have the following fields :</p><table><thead><tr><th>Field</th><th>Field value</th><th>Description</th></tr></thead><tbody><tr><td>Event time</td><td>eventId</td><td>Timestamp of the event record in epoch nanoseconds.</td></tr><tr><td>Trace Id</td><td>tracedId</td><td>Each trace is uniquely identified by a trace id.</td></tr><tr><td>Span Id</td><td>spanId</td><td>Each span within a trace is uniquely identified by a span id.</td></tr><tr><td>Span Kind</td><td>spanKind</td><td>Span kind is a property of span indicating the type of span. It helps in understanding the nature of the unit of work done by the Span.</td></tr><tr><td>Event name</td><td>eventName</td><td>This maps to the log message.</td></tr><tr><td>Event attributes</td><td>eventAttributes</td><td>This forms the crux of the event logs, based on the operation executed, it has JSON formatted key-value pairs. This also includes a handler class attribute, to show the logger class.</td></tr></tbody></table><p>Sample log</p><pre><code>FINE [LoggingOptions$1.lambda$export$1] - {
  &quot;traceId&quot;: &quot;fc8aef1d44b3cc8bc09eb8e581c4a8eb&quot;,
  &quot;spanId&quot;: &quot;b7d3b9865d3ddd45&quot;,
  &quot;spanKind&quot;: &quot;INTERNAL&quot;,
  &quot;eventTime&quot;: 1597819675128886121,
  &quot;eventName&quot;: &quot;Session request execution complete&quot;,
  &quot;attributes&quot;: {
    &quot;http.status_code&quot;: 200,
    &quot;http.handler_class&quot;: &quot;org.openqa.selenium.grid.router.HandleSession&quot;,
    &quot;http.url&quot;: &quot;\u002fsession\u002fdd35257f104bb43fdfb06242953f4c85&quot;,
    &quot;http.method&quot;: &quot;DELETE&quot;,
    &quot;session.id&quot;: &quot;dd35257f104bb43fdfb06242953f4c85&quot;
  }
}
</code></pre><p>In addition to the above fields, based on <a href=https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/exceptions.md>OpenTelemetry specification</a> error logs consist of :</p><table><thead><tr><th>Field</th><th>Field value</th><th>Description</th></tr></thead><tbody><tr><td>Exception type</td><td>exception.type</td><td>The class name of the exception.</td></tr><tr><td>Exception message</td><td>exception.message</td><td>Reason for the exception.</td></tr><tr><td>Exception stacktrace</td><td>exception.stacktrace</td><td>Prints the call stack at the point of time when the exception was thrown. Helps in understanding the origin of the exception.</td></tr></tbody></table><p>Sample error log</p><pre><code>WARN [LoggingOptions$1.lambda$export$1] - {
  &quot;traceId&quot;: &quot;7efa5ea57e02f89cdf8de586fe09f564&quot;,
  &quot;spanId&quot;: &quot;914df6bc9a1f6e2b&quot;,
  &quot;spanKind&quot;: &quot;INTERNAL&quot;,
  &quot;eventTime&quot;: 1597820253450580272,
  &quot;eventName&quot;: &quot;exception&quot;,
  &quot;attributes&quot;: {
    &quot;exception.type&quot;: &quot;org.openqa.selenium.ScriptTimeoutException&quot;,
    &quot;exception.message&quot;: &quot;Unable to execute request: java.sql.SQLSyntaxErrorException: Table 'mysql.sessions_mappa' doesn't exist ...&quot; (full message will be printed),
    &quot;exception.stacktrace&quot;: &quot;org.openqa.selenium.ScriptTimeoutException: java.sql.SQLSyntaxErrorException: Table 'mysql.sessions_mappa' doesn't exist\nBuild info: version: '4.0.0-alpha-7', revision: 'Unknown'\nSystem info: host: 'XYZ-MacBook-Pro.local', ip: 'fe80:0:0:0:10d5:b63a:bdc6:1aff%en0', os.name: 'Mac OS X', os.arch: 'x86_64', os.version: '10.13.6', java.version: '11.0.7'\nDriver info: driver.version: unknown ....&quot; (full stack will be printed),
    &quot;http.handler_class&quot;: &quot;org.openqa.selenium.grid.distributor.remote.RemoteDistributor&quot;,
    &quot;http.url&quot;: &quot;\u002fsession&quot;,
    &quot;http.method&quot;: &quot;POST&quot;
  }
}
</code></pre><p>Note: Logs are pretty printed above for readability. Pretty printing for logs is turned off in Selenium server.</p><p>The steps above should set you up for seeing traces and logs.</p><h2 id=references>References</h2><ol><li><a href=https://lightstep.com/blog/opentelemetry-101-what-is-tracing/>Understanding Tracing</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/api.md#status>OpenTelemetry Tracing API Specification</a></li><li><a href=https://github.com/SeleniumHQ/selenium/wiki>Selenium Wiki</a></li><li><a href=https://www.honeycomb.io/blog/how-are-structured-logs-different-from-events/>Structured logs vs events</a></li><li><a href=https://github.com/jaegertracing/jaeger>Jaeger framework</a></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-76186a5d24597c9acf1bcb112d5b8cb6>2 - GraphQL query support</h1><p>GraphQL is a query language for APIs and a runtime for fulfilling those queries
with your existing data. It gives users the power to ask for exactly what they need and nothing more.</p><h2 id=enums>Enums</h2><p>Enums represent possible sets of values for a field.</p><p>For example, the <code>Node</code> object has a field called <code>status</code>. The state is an enum
(specifically, of type <code>Status</code>) because it may be <code>UP</code> , <code>DRAINING</code> or <code>UNAVAILABLE</code>.</p><h2 id=scalars>Scalars</h2><p>Scalars are primitive values: <code>Int</code>, <code>Float</code>, <code>String</code>, <code>Boolean</code>, or <code>ID</code>.</p><p>When calling the GraphQL API, you must specify nested subfield until you return only scalars.</p><h2 id=structure-of-the-schema>Structure of the Schema</h2><p>The structure of grid schema is as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    session<span style=color:#ce5c00;font-weight:700>(</span>id: <span style=color:#4e9a06>&#34;&lt;session-id&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        id,
</span></span><span style=display:flex><span>        capabilities,
</span></span><span style=display:flex><span>        startTime,
</span></span><span style=display:flex><span>        uri,
</span></span><span style=display:flex><span>        nodeId,
</span></span><span style=display:flex><span>        nodeUri,
</span></span><span style=display:flex><span>        sessionDurationMillis
</span></span><span style=display:flex><span>        slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            id,
</span></span><span style=display:flex><span>            stereotype,
</span></span><span style=display:flex><span>            lastStarted
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    grid: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        uri,
</span></span><span style=display:flex><span>        totalSlots,
</span></span><span style=display:flex><span>        nodeCount,
</span></span><span style=display:flex><span>        maxSession,
</span></span><span style=display:flex><span>        sessionCount,
</span></span><span style=display:flex><span>        version,
</span></span><span style=display:flex><span>        sessionQueueSize
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    sessionsInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        sessionQueueRequests,
</span></span><span style=display:flex><span>        sessions: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                id,
</span></span><span style=display:flex><span>                capabilities,
</span></span><span style=display:flex><span>                startTime,
</span></span><span style=display:flex><span>                uri,
</span></span><span style=display:flex><span>                nodeId,
</span></span><span style=display:flex><span>                nodeUri,
</span></span><span style=display:flex><span>                sessionDurationMillis
</span></span><span style=display:flex><span>                slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    id,
</span></span><span style=display:flex><span>                    stereotype,
</span></span><span style=display:flex><span>                    lastStarted
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    nodesInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        nodes : <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                id,
</span></span><span style=display:flex><span>                uri,
</span></span><span style=display:flex><span>                status,
</span></span><span style=display:flex><span>                maxSession,
</span></span><span style=display:flex><span>                slotCount,
</span></span><span style=display:flex><span>                sessions: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                        id,
</span></span><span style=display:flex><span>                        capabilities,
</span></span><span style=display:flex><span>                        startTime,
</span></span><span style=display:flex><span>                        uri,
</span></span><span style=display:flex><span>                        nodeId,
</span></span><span style=display:flex><span>                        nodeUri,
</span></span><span style=display:flex><span>                        sessionDurationMillis
</span></span><span style=display:flex><span>                        slot : <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                            id,
</span></span><span style=display:flex><span>                            stereotype,
</span></span><span style=display:flex><span>                            lastStarted
</span></span><span style=display:flex><span>                        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>]</span>,
</span></span><span style=display:flex><span>                sessionCount,
</span></span><span style=display:flex><span>                stereotypes,
</span></span><span style=display:flex><span>                version,
</span></span><span style=display:flex><span>                osInfo: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    arch,
</span></span><span style=display:flex><span>                    name,
</span></span><span style=display:flex><span>                    version
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=querying-graphql>Querying GraphQL</h2><p>The best way to query GraphQL is by using <code>curl</code> requests. The query is interpreted as JSON. Ensure double quotes are properly escaped to avoid unexpected errors.
GraphQL allows you to fetch only the data that you want, nothing more nothing less.</p><p>Some of the example GraphQL queries are given below. You can build your own
queries as you like.</p><h3 id=querying-the-number-of-maxsession-and-sessioncount-in-the-grid->Querying the number of <code>maxSession</code> and <code>sessionCount</code> in the grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ grid { maxSession, sessionCount } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><p>Generally on local machine the <code>&lt;LINK_TO_GRAPHQL_ENDPOINT></code> would be <code>http://localhost:4444/graphql</code></p><h3 id=querying-all-details-for-session-node-and-the-grid->Querying all details for session, node and the Grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { uri, maxSession, sessionCount }, nodesInfo { nodes { id, uri, status, sessions { id, capabilities, startTime, uri, nodeId, nodeUri, sessionDurationMillis, slot { id, stereotype, lastStarted } }, slotCount, sessionCount }} }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-for-getting-the-current-session-count-in-the-grid->Query for getting the current session count in the Grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { sessionCount } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-for-getting-the-max-session-count-in-the-grid->Query for getting the max session count in the Grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { maxSession } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-for-getting-all-session-details-for-all-nodes-in-the-grid->Query for getting all session details for all nodes in the Grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessions { id, capabilities, startTime, uri, nodeId, nodeId, sessionDurationMillis } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-to-get-slot-information-for-all-sessions-in-each-node-in-the-grid->Query to get slot information for all sessions in each Node in the Grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessions { id, slot { id, stereotype, lastStarted } } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-to-get-session-information-for-a-given-session>Query to get session information for a given session:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ session (id: \&#34;&lt;session-id&gt;\&#34;) { id, capabilities, startTime, uri, nodeId, nodeUri, sessionDurationMillis, slot { id, stereotype, lastStarted } } } &#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=querying-the-capabilities-of-each-node-in-the-grid->Querying the capabilities of each node in the grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { stereotypes } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=querying-the-status-of-each-node-in-the-grid->Querying the status of each node in the grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { status } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=querying-the-uri-of-each-node-and-the-grid->Querying the URI of each node and the grid :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;: &#34;{ nodesInfo { nodes { uri } } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-for-getting-the-current-requests-in-the-new-session-queue>Query for getting the current requests in the New Session Queue:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ sessionsInfo { sessionQueueRequests } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div><h3 id=query-for-getting-the-new-session-queue-size->Query for getting the New Session Queue size :</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -X POST -H <span style=color:#4e9a06>&#34;Content-Type: application/json&#34;</span> --data <span style=color:#4e9a06>&#39;{&#34;query&#34;:&#34;{ grid { sessionQueueSize } }&#34;}&#39;</span> -s &lt;LINK_TO_GRAPHQL_ENDPOINT&gt;
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-69471da8f601bc6b170f1ec47d69f853>3 - Grid endpoints</h1><h2 id=grid>Grid</h2><h3 id=grid-status>Grid Status</h3><p>Grid status provides the current state of the Grid. It consists of details about every registered Node.
For every Node, the status includes information regarding Node availability, sessions, and slots.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL GET <span style=color:#4e9a06>&#39;http://localhost:4444/status&#39;</span>
</span></span></code></pre></div><h3 id=delete-session>Delete session</h3><p>Deleting the session terminates the WebDriver session, quits the driver and removes it from the active sessions map.
Any request using the removed session-id or reusing the driver instance will throw an error.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/session/&lt;session-id&gt;&#39;</span>
</span></span></code></pre></div><h3 id=which-url-should-i-use>Which URL should I use?</h3><p>In the Standalone mode, the Grid URL is the Standalone server address.</p><p>In the Hub-Node mode, the Grid URL is the Hub server address.</p><p>In the fully distributed mode, the Grid URL is the Router server address.</p><p>Default URL for all the above modes is http://localhost:4444.</p><h2 id=distributor>Distributor</h2><h3 id=remove-node>Remove Node</h3><p>To remove the Node from the Grid, use the cURL command enlisted below.
It does not stop any ongoing session running on that Node.
The Node continues running as it is unless explicitly killed.
The Distributor is no longer aware of the Node and hence any matching new session request
will not be forwarded to that Node.</p><p>In the Standalone mode, the Distributor URL is the Standalone server address.</p><p>In the Hub-Node mode, the Distributor URL is the Hub server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt; &#39;</span>
</span></span></code></pre></div><p>In the fully distributed mode, the URL is the Router server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>If no registration secret has been configured while setting up the Grid, then use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;Router-URL&gt;/se/grid/distributor/node/&lt;node-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=drain-node>Drain Node</h3><p>Node drain command is for graceful node shutdown.
Draining a Node stops the Node after all the ongoing sessions are complete.
However, it does not accept any new session requests.</p><p>In the Standalone mode, the Distributor URL is the Standalone server address.</p><p>In the Hub-Node mode, the Distributor URL is the Hub server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt; &#39;</span>
</span></span></code></pre></div><p>In the fully distributed mode, the URL is the Router server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>If no registration secret has been configured while setting up the Grid, then use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://&lt;Router-URL&gt;/se/grid/distributor/node/&lt;node-id&gt;/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h2 id=node>Node</h2><p>The endpoints in this section are applicable for Hub-Node mode and fully distributed Grid mode where the
Node runs independently.
The default Node URL is http://localhost:5555 in case of one Node.
In case of multiple Nodes, use <a href=/documentation/grid/advanced_features/endpoints/#grid-status>Grid status</a> to get all Node details and locate the Node address.</p><h3 id=status>Status</h3><p>The Node status is essentially a health-check for the Node.
Distributor pings the node status are regular intervals and updates the Grid Model accordingly.
The status includes information regarding availability, sessions, and slots.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:5555/status&#39;</span>
</span></span></code></pre></div><h3 id=drain>Drain</h3><p>Distributor passes the <a href=/documentation/grid/advanced_features/endpoints/#drain-node>drain</a> command to the appropriate node identified by the node-id.
To drain the Node directly, use the cuRL command enlisted below.
Both endpoints are valid and produce the same result. Drain finishes the ongoing sessions before stopping the Node.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>If no registration secret has been configured while setting up the Grid, then use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request POST <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/drain&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=check-session-owner>Check session owner</h3><p>To check if a session belongs to a Node, use the cURL command enlisted below.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/owner/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>If no registration secret has been configured while setting up the Grid, then use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/owner/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><p>It will return true if the session belongs to the Node else it will return false.</p><h3 id=delete-session-1>Delete session</h3><p>Deleting the session terminates the WebDriver session, quits the driver and removes it from the active sessions map.
Any request using the removed session-id or reusing the driver instance will throw an error.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:5555/se/grid/node/session/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>If no registration secret has been configured while setting up the Grid, then use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;node-URL&gt;/se/grid/node/session/&lt;session-id&gt;&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h2 id=new-session-queue>New Session Queue</h2><h3 id=clear-new-session-queue>Clear New Session Queue</h3><p>New Session Request Queue holds the new session requests.
To clear the queue, use the cURL command enlisted below.
Clearing the queue rejects all the requests in the queue. For each such request, the server returns an error response to the respective client.
The result of the clear command is the total number of deleted requests.</p><p>In the Standalone mode, the Queue URL is the Standalone server address.</p><p>In the Hub-Node mode, the Queue URL is the Hub server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>In the fully distributed mode, the Queue URL is Router server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET: &lt;secret&gt;&#39;</span>
</span></span></code></pre></div><p>If no registration secret has been configured while setting up the Grid, then use</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request DELETE <span style=color:#4e9a06>&#39;http://&lt;Router-URL&gt;/se/grid/newsessionqueue/queue&#39;</span> --header <span style=color:#4e9a06>&#39;X-REGISTRATION-SECRET;&#39;</span>
</span></span></code></pre></div><h3 id=get-new-session-queue-requests>Get New Session Queue Requests</h3><p>New Session Request Queue holds the new session requests.
To get the current requests in the queue, use the cURL command enlisted below.
The response returns the total number of requests in the queue and the request payloads.</p><p>In the Standalone mode, the Queue URL is the Standalone server address.</p><p>In the Hub-Node mode, the Queue URL is the Hub server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span>
</span></span></code></pre></div><p>In the fully distributed mode, the Queue URL is Router server address.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cURL --request GET <span style=color:#4e9a06>&#39;http://localhost:4444/se/grid/newsessionqueue/queue&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-abdf1d3e182274141e4d8a3e7686dcf8>4 - Customizing a Node</h1><h2 id=how-to-customize-a-node>How to customize a Node</h2><p>There are times when we would like a Node to be customized to our needs.</p><p>For e.g., we may like to do some additional setup before a session begins execution and some clean-up after a session runs to completion.</p><p>Following steps can be followed for this:</p><ul><li><p>Create a class that extends <code>org.openqa.selenium.grid.node.Node</code></p></li><li><p>Add a static method (this will be our factory method) to the newly created class whose signature looks like this:</p><p><code>public static Node create(Config config)</code>. Here:</p><ul><li><code>Node</code> is of type <code>org.openqa.selenium.grid.node.Node</code></li><li><code>Config</code> is of type <code>org.openqa.selenium.grid.config.Config</code></li></ul></li><li><p>Within this factory method, include logic for creating your new Class.</p></li><li><p>To wire in this new customized logic into the hub, start the node and pass in the fully qualified class name of the above class to the argument <code>--node-implementation</code></p></li></ul><p>Let&rsquo;s see an example of all this:</p><h3 id=custom-node-as-an-uber-jar>Custom Node as an uber jar</h3><ol><li>Create a sample project using your favourite build tool (<strong>Maven</strong>|<strong>Gradle</strong>).</li><li>Add the below dependency to your sample project.<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-grid>org.seleniumhq.selenium/selenium-grid</a></li></ul></li><li>Add your customized Node to the project.</li><li>Build an <a href=https://imagej.net/develop/uber-jars>uber jar</a> to be able to start the Node using <code>java -jar</code> command.</li><li>Now start the Node using the command:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar custom_node-server.jar node <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--node-implementation org.seleniumhq.samples.DecoratedLoggingNode
</span></span></code></pre></div><p><strong>Note:</strong> If you are using Maven as a build tool, please prefer using <a href=https://maven.apache.org/plugins/maven-shade-plugin>maven-shade-plugin</a> instead of <a href=https://maven.apache.org/plugins/maven-assembly-plugin>maven-assembly-plugin</a> because maven-assembly plugin seems to have issues with being able to merge multiple Service Provider Interface files (<code>META-INF/services</code>)</p><h3 id=custom-node-as-a-regular-jar>Custom Node as a regular jar</h3><ol><li>Create a sample project using your favourite build tool (<strong>Maven</strong>|<strong>Gradle</strong>).</li><li>Add the below dependency to your sample project.<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-grid>org.seleniumhq.selenium/selenium-grid</a></li></ul></li><li>Add your customized Node to the project.</li><li>Build a jar of your project using your build tool.</li><li>Now start the Node using the command:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>java -jar selenium-server-4.6.0.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext custom_node-1.0-SNAPSHOT.jar node <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--node-implementation org.seleniumhq.samples.DecoratedLoggingNode
</span></span></code></pre></div><p>Below is a sample that just prints some messages on to the console whenever there&rsquo;s an activity of interest (session created, session deleted, a webdriver command executed etc.,) on the Node.</p><details><summary>Sample customized node</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.seleniumhq.samples</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.io.IOException</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.net.URI</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.util.UUID</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>java.util.function.Supplier</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.Capabilities</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.NoSuchSessionException</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.WebDriverException</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.config.Config</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.CreateSessionRequest</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.CreateSessionResponse</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.NodeId</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.NodeStatus</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.data.Session</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.log.LoggingOptions</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.node.HealthCheck</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.node.Node</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.node.local.LocalNodeFactory</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.security.Secret</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.security.SecretOptions</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.grid.server.BaseServerOptions</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.internal.Either</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.io.TemporaryFilesystem</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.SessionId</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpRequest</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.http.HttpResponse</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>import</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>org.openqa.selenium.remote.tracing.Tracer</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DecoratedLoggingNode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DecoratedLoggingNode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Tracer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tracer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodeId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>URI</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Secret</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>registrationSecret</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Duration</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionTimeout</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tracer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>registrationSecret</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionTimeout</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>create</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Config</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>config</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>LoggingOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>loggingOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoggingOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>BaseServerOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>serverOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BaseServerOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>URI</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uri</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>serverOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExternalUri</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>SecretOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>secretOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SecretOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>NodeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeOptions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodeOptions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Duration</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionTimeout</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nodeOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getSessionTimeout</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Refer to the foot notes for additional context on this line.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LocalNodeFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>create</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>config</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>DecoratedLoggingNode</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wrapper</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DecoratedLoggingNode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>loggingOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getTracer</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getId</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>uri</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>secretOptions</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getRegistrationSecret</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>sessionTimeout</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>wrapper</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>node</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wrapper</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Either</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>WebDriverException</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CreateSessionResponse</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>newSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>CreateSessionRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessionRequest</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>newSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sessionRequest</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;newSession&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executeWebDriverCommand</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>HttpRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>executeWebDriverCommand</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;executeWebDriverCommand&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Session</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSuchSessionException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getSession</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;getSession&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uploadFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>HttpRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>uploadFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;uploadFile&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HttpResponse</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>downloadFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>HttpRequest</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>downloadFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>req</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;downloadFile&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TemporaryFilesystem</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getDownloadsFilesystem</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>UUID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uuid</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getDownloadsFilesystem</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>uuid</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>catch</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>IOException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>throw</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RuntimeException</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;downloadsFilesystem&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TemporaryFilesystem</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUploadsFilesystem</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IOException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUploadsFilesystem</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>catch</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>IOException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>throw</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RuntimeException</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>},</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;uploadsFilesystem&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stop</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NoSuchSessionException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>stop</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;stop&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isSessionOwner</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SessionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>isSessionOwner</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;isSessionOwner&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isSupporting</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Capabilities</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>capabilities</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>isSupporting</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>capabilities</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;isSupporting&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NodeStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getStatus</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;getStatus&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HealthCheck</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getHealthCheck</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getHealthCheck</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;getHealthCheck&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>drain</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>drain</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;drain&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>isReady</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>node</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>isReady</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;isReady&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Runnable</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>function</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operation</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>err</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[COMMENTATOR] Before %s()%n&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operation</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>function</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>run</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>err</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[COMMENTATOR] After %s()%n&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operation</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>T</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>perform</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Supplier</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>function</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operation</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>err</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[COMMENTATOR] Before %s()%n&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operation</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>function</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>finally</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>err</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[COMMENTATOR] After %s()%n&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operation</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></details><p><strong><em>Foot Notes:</em></strong></p><p>In the above example, the line <code>Node node = LocalNodeFactory.create(config);</code> explicitly creates a <code>LocalNode</code>.</p><p>There are basically 2 types of <em>user facing implementations</em> of <code>org.openqa.selenium.grid.node.Node</code> available.</p><p>These classes are good starting points to learn how to build a custom Node and also to learn the internals of a Node.</p><ul><li><code>org.openqa.selenium.grid.node.local.LocalNode</code> - Used to represent a long running Node and is the default implementation that gets wired in when you start a <code>node</code>.<ul><li>It can be created by calling <code>LocalNodeFactory.create(config);</code>, where:<ul><li><code>LocalNodeFactory</code> belongs to <code>org.openqa.selenium.grid.node.local</code></li><li><code>Config</code> belongs to <code>org.openqa.selenium.grid.config</code></li></ul></li></ul></li><li><code>org.openqa.selenium.grid.node.k8s.OneShotNode</code> - This is a special reference implementation wherein the Node gracefully shuts itself down after servicing one test session. This class is currently not available as part of any pre-built maven artifact.<ul><li>You can refer to the source code <a href=https://github.com/SeleniumHQ/selenium/blob/trunk/java/src/org/openqa/selenium/grid/node/k8s/OneShotNode.java>here</a> to understand its internals.</li><li>To build it locally refer <a href=https://github.com/SeleniumHQ/selenium/blob/trunk/deploys/k8s/README.md>here</a>.</li><li>It can be created by calling <code>OneShotNode.create(config)</code>, where:<ul><li><code>OneShotNode</code> belongs to <code>org.openqa.selenium.grid.node.k8s</code></li><li><code>Config</code> belongs to <code>org.openqa.selenium.grid.config</code></li></ul></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fe0209b2f377f5b9f5e592aade250b62>5 - External datastore</h1><h2 id=table-of-contents>Table of Contents</h2><ul><li><a href=/documentation/grid/advanced_features/external_datastore/#introduction>Introduction</a></li><li><a href=/documentation/grid/advanced_features/external_datastore/#setup>Setup</a></li><li><a href=/documentation/grid/advanced_features/external_datastore/#database-backed-session-map>Database backed Session Map</a><ul><li><a href=/documentation/grid/advanced_features/external_datastore/#steps>Steps</a></li></ul></li><li><a href=/documentation/grid/advanced_features/external_datastore/#redis-backed-session-map>Redis backed Session Map</a><ul><li><a href=/documentation/grid/advanced_features/external_datastore/#steps>Steps</a></li></ul></li></ul><h2 id=introduction>Introduction</h2><p>Selenium Grid allows you to persist information related to currently running sessions into an external data store.
The external data store could be backed by your favourite database (or) Redis Cache system.</p><h2 id=setup>Setup</h2><ul><li><a href=https://get-coursier.io/docs/cli-installation>Coursier</a> - As a dependency resolver, so that we can download maven artifacts on the fly and make them available in our classpath</li><li><a href=https://docs.docker.com/engine/install/>Docker</a> - To manage our PostGreSQL/Redis docker containers.</li></ul><h2 id=database-backed-session-map>Database backed Session Map</h2><p>For the sake of this illustration, we are going to work with PostGreSQL database.</p><p>We will spin off a PostGreSQL database as a docker container using a docker compose file.</p><h3 id=steps>Steps</h3><p>You can skip this step if you already have a PostGreSQL database instance available at your disposal.</p><ul><li>Create a sql file named <code>init.sql</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>CREATE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>TABLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>IF</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>NOT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>EXISTS</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sessions_map</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_ids</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_caps</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_uri</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_stereotype</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>text</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>session_start</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>In the same directory as the <code>init.sql</code>, create a file named <code>docker-compose.yml</code> with its contents as below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.8&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>db</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>postgres:9.6-bullseye</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>restart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>always</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_USER=seluser</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_PASSWORD=seluser</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>POSTGRES_DB=selenium_sessions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;5432:5432&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>./init.sql:/docker-entrypoint-initdb.d/init.sql</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We can now start our database container by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><p><em>Our database name is <code>selenium_sessions</code> with its username and password set to <code>seluser</code></em></p><p>If you are working with an already running PostGreSQL DB instance, then you just need to create a database named <code>selenium_sessions</code> and the table <code>sessions_map</code> using the above mentioned SQL statement.</p><ul><li>Create a Selenium Grid configuration file named <code>sessions.toml</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessions</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>implementation</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;org.openqa.selenium.grid.sessionmap.jdbc.JdbcBackedSessionMap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-url</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbc:postgresql://localhost:5432/selenium_sessions&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-user</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;seluser&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>jdbc-password</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;seluser&#34;</span>
</span></span></code></pre></div><p><em>Note:</em> If you plan to use an existing PostGreSQL DB instance, then replace <code>localhost:5432</code> with the actual host and port number of your instance.</p><ul><li>Below is a simple shell script (let&rsquo;s call it <code>distributed.sh</code>) that we will use to bring up our distributed Grid.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span><span style=color:#000>JAR_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar
</span></span><span style=display:flex><span><span style=color:#000>PUBLISH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--publish-events tcp://localhost:4442&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SUBSCRIBE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--subscribe-events tcp://localhost:4443&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessions http://localhost:5556&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS_QUEUE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessionqueue http://localhost:5559&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Event Bus&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> event-bus <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5557</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting New Session Queue&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Sessions Map&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-jdbc:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span> org.postgresql:postgresql:42.3.1<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Distributor&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span>  distributor <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000>$SESSIONS</span> <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Router&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> router <span style=color:#000>$SESSIONS</span> --distributor http://localhost:5553 <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>4444</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Node&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> node <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><ul><li><p>At this point the current directory should contain the following files:</p><ul><li><code>docker-compose.yml</code></li><li><code>init.sql</code></li><li><code>sessions.toml</code></li><li><code>distributed.sh</code></li></ul></li><li><p>You can now spawn the Grid by running <code>distributed.sh</code> shell script and quickly run a test. You will notice that the Grid now stores session information into the PostGreSQL database.</p></li></ul><p>In the line which spawns a <code>SessionMap</code> on a machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span>java -jar selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-jdbc:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span> org.postgresql:postgresql:42.3.1<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions --publish-events tcp://localhost:4442 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--subscribe-events tcp://localhost:4443 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml 
</span></span></code></pre></div><ul><li>The variable names from the above script have been replaced with their actual values for clarity.</li><li>Remember to substitute <code>localhost</code> with the actual hostname of the machine where your <code>Event-Bus</code> is running.</li><li>The arguments being passed to <code>coursier</code> are basically the GAV (Group Artifact Version) Maven co-ordinates of:<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-session-map-jdbc>selenium-session-map-jdbc</a> which is needed to help us store sessions information in database</li><li><a href=https://mvnrepository.com/artifact/org.postgresql/postgresql>postgresql</a> which is needed to help us talk PostGreSQL database.</li></ul></li><li><code>sessions.toml</code> is the configuration file that we created earlier.</li></ul><h2 id=redis-backed-session-map>Redis backed Session Map</h2><p>We will spin off a Redis Cache docker container using a docker compose file.</p><h3 id=steps-1>Steps</h3><p>You can skip this step if you already have a Redis Cache instance available at your disposal.</p><ul><li>Create a file named <code>docker-compose.yml</code> with its contents as below:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;3.8&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>redis</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redis:bullseye</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>restart</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>always</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;6379:6379&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We can now start our Redis container by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><ul><li>Create a Selenium Grid configuration file named <code>sessions.toml</code> with the below contents:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#000;font-weight:700>[</span><span style=color:#000>sessions</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>scheme</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;redis&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>implementation</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;org.openqa.selenium.grid.sessionmap.redis.RedisBackedSessionMap&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>hostname</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;localhost&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>port</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>6379</span>
</span></span></code></pre></div><p><em>Note:</em> If you plan to use an existing Redis Cache instance, then replace <code>localhost</code> and <code>6379</code> with the actual host and port number of your instance.</p><ul><li>Below is a simple shell script (let&rsquo;s call it <code>distributed.sh</code>) that we will use to bring up our distributed grid.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span><span style=color:#000>JAR_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar
</span></span><span style=display:flex><span><span style=color:#000>PUBLISH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--publish-events tcp://localhost:4442&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SUBSCRIBE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--subscribe-events tcp://localhost:4443&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessions http://localhost:5556&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>SESSIONS_QUEUE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--sessionqueue http://localhost:5559&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Event Bus&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> event-bus <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5557</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting New Session Queue&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> sessionqueue --port <span style=color:#0000cf;font-weight:700>5559</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Session Map&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-redis:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span><span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> --port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Distributor&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span>  distributor <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000>$SESSIONS</span> <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>5553</span> --bind-bus <span style=color:#204a87>false</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Router&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> router <span style=color:#000>$SESSIONS</span> --distributor http://localhost:5553 <span style=color:#000>$SESSIONS_QUEUE</span> --port <span style=color:#0000cf;font-weight:700>4444</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Starting Node&#39;</span>
</span></span><span style=display:flex><span>java -jar <span style=color:#000>$JAR_NAME</span> node <span style=color:#000>$PUBLISH</span> <span style=color:#000>$SUBSCRIBE</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span></code></pre></div><ul><li><p>At this point the current directory should contain the following files:</p><ul><li><code>docker-compose.yml</code></li><li><code>sessions.toml</code></li><li><code>distributed.sh</code></li></ul></li><li><p>You can now spawn the Grid by running <code>distributed.sh</code> shell script and quickly run a test. You will notice that the Grid now stores session information into the Redis instance. You can perhaps make use of a Redis GUI such as <a href=https://tableplus.com/>TablePlus</a> to see them (Make sure that you have setup a debug point in your test, because the values will get deleted as soon as the test runs to completion).</p></li></ul><p>In the line which spawns a <code>SessionMap</code> on a machine:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;current_selenium_version&gt;
</span></span><span style=display:flex><span>java -jar selenium-server-<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span>.jar <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--ext <span style=color:#204a87;font-weight:700>$(</span>coursier fetch -p org.seleniumhq.selenium:selenium-session-map-redis:<span style=color:#4e9a06>${</span><span style=color:#000>SE_VERSION</span><span style=color:#4e9a06>}</span><span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>sessions --publish-events tcp://localhost:4442 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--subscribe-events tcp://localhost:4443 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--port <span style=color:#0000cf;font-weight:700>5556</span> --config sessions.toml 
</span></span></code></pre></div><ul><li>The variable names from the above script have been replaced with their actual values for clarity.</li><li>Remember to substitute <code>localhost</code> with the actual hostname of the machine where your <code>Event-Bus</code> is running.</li><li>The arguments being passed to <code>coursier</code> are basically the GAV (Group Artifact Version) Maven co-ordinates of:<ul><li><a href=https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-session-map-redis>selenium-session-map-redis</a> which is needed to help us store sessions information in Redis Cache.</li></ul></li><li><code>sessions.toml</code> is the configuration file that we created earlier.</li></ul></div></main></div></div><div class="row justify-content-center p-5"><h2 class="selenium text-center" id=dev-partners>Development Partners</h2></div><div class="row justify-content-around pt-4 pb-5 px-5"><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://www.browserstack.com/automate?utm_campaign=open-source-sponsor&amp;utm_campaigncode=701OW000009sQwVYAU&amp;utm_medium=partnered&amp;utm_source=seleniumorg" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/browserstack.png alt=BrowserStack title=BrowserStack></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://saucelabs.com/resources/topic-hub/selenium?utm_source=selenium&amp;utm_medium=website&amp;utm_campaign=selenium-sponsorship-fy25" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/saucelabs.png alt="Sauce Labs" title="Sauce Labs"></a></div></div><div class="row justify-content-center p-5"><h2 class="selenium text-center" id=selenium-level>Selenium Level Sponsors</h2></div><div class="row justify-content-around pt-4 pb-5 px-5"><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://brightdata.com/?utm_source=brand&amp;utm_campaign=brnd-mkt_partners_selenium" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/bright-data.png alt="Bright Data" title="Bright Data"></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href=https://applitools.com/ class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/applitools.png alt=Applitools title=Applitools></a></div><div class="col-lg-3 col-md-6 mb-4 mb-lg-0 align-self-center px-5 py-3"><a href="https://www.lambdatest.com/selenium-automation?utm_source=selenium&amp;utm_medium=open-source-sponsor&amp;utm_campaign=nov_14&amp;utm_term=sk&amp;utm_content=web" class=border-0><img class="w-100 shadow-1-strong rounded selenium-backer-logo" src=/images/sponsors/lambda-test.png alt=LambdaTest title=LambdaTest></a></div></div><div class="row justify-content-center pt-2 pb-3 -bg-selenium-cyan"><div class="card text-center border-0 bg-transparent py-5"><div class="card-body text-white"><h2 class=card-title>Support the Selenium Project</h2><p class=card-text>Learn more or view the full list of sponsors.</p><div class=selenium-button-container><a href=/sponsors class="selenium-button selenium-white-cyan text-uppercase fw-bold">Learn more
<i class="ps-3 fas fa-caret-right"></i></a></div></div></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/group/selenium-users aria-label="User mailing list"><i class="fas fa-mail-bulk"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Selenium in Twitter" aria-label="Selenium in Twitter"><a class=text-white target=_blank rel=noopener href=https://twitter.com/SeleniumHQ aria-label="Selenium in Twitter"><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="SeleniumConf YouTube Channel" aria-label="SeleniumConf YouTube Channel"><a class=text-white target=_blank rel=noopener href=https://www.youtube.com/channel/UCbDlgX_613xNMrDqCe3QNEw aria-label="SeleniumConf YouTube Channel"><i class="fab fa-youtube"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Software Freedom Conservancy" aria-label="Software Freedom Conservancy"><a class=text-white target=_blank rel=noopener href=mailto:selenium@sfconservancy.org aria-label="Software Freedom Conservancy"><i class="fas fa-envelope-square"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/seleniumhq/selenium aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://join.slack.com/t/seleniumhq/shared_invite/zt-2stlcmc6b-Hww~3r3yAzquhSq4riOFxA aria-label=Slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title=IRC aria-label=IRC><a class=text-white target=_blank rel=noopener href=https://kiwiirc.com/nextclient/irc.libera.chat/#selenium aria-label=IRC><i class="fas fa-comments"></i></a></li><li class="list-inline-item mx-2 h3" data-bs-toggle=tooltip data-bs-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/selenium-developers aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><a href=https://www.netlify.com><img style=margin-right:50px src=https://www.netlify.com/v3/img/components/netlify-light.svg alt="Deploys by Netlify"></a></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 Software Freedom Conservancy All Rights Reserved</small><p class=mt-2><a href=/about/>About Selenium</a></p></div></div></div></footer></div><script src=/js/main.min.0a56205ed1c75268f017591e5418fdb944578a279fe7c7abe3981ebed191c341.js integrity="sha256-ClYgXtHHUmjwF1keVBj9uURXiief58er45gevtGRw0E=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=https://cdn.jsdelivr.net/npm/@docsearch/js@3.6.0 integrity="sha512-FtDaTWf3IS29TLuYzTPlytjGqcXkwrzG9ivq7xXElnOZeiYTbcIy/hwXAgrrRNnI0+PfN+WFz4/+4phhJmuS8Q==" crossorigin=anonymous></script><script type=text/javascript>const containers=["#docsearch-0","#docsearch-1"];for(let e of containers)docsearch({container:e,appId:"6IOXA5JK7Z",apiKey:"2b44a1d3530f9951dd6502059058984a",indexName:"selenium"})</script><script src=/js/tabpane-persist.js></script></body></html>